const __vite__fileDeps=["./MapContainerLeafets-Dw04F47a.js","./index-oYe28LAK.js","./index-U6s40cd-.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as b,m as R,p as D,J as M,j as t,P as O}from"./index-oYe28LAK.js";var w={};Object.defineProperty(w,"__esModule",{value:!0});var G=w.useGeolocated=void 0;const n=b;function I(l={}){const{positionOptions:e={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:m=!0,userDecisionTimeout:u=void 0,suppressLocationOnMount:f=!1,watchPosition:a=!1,geolocationProvider:s=typeof navigator<"u"?navigator.geolocation:void 0,watchLocationPermissionChange:g=!1,onError:r,onSuccess:c}=l,d=(0,n.useRef)(0),i=(0,n.useRef)(!0),x=(0,n.useRef)(0),[S,P]=(0,n.useState)(m),[k,y]=(0,n.useState)(),[A,T]=(0,n.useState)(),[_,E]=(0,n.useState)(),[L,N]=(0,n.useState)(),p=(0,n.useCallback)(()=>{d.current&&window.clearTimeout(d.current)},[]),h=(0,n.useCallback)(o=>{p(),i.current&&(y(()=>{}),P(!1),E(o)),r==null||r(o)},[r,p]),v=(0,n.useCallback)(o=>{p(),i.current&&(y(o.coords),T(o.timestamp),P(!0),E(()=>{})),c==null||c(o)},[c,p]),C=(0,n.useCallback)(()=>{if(!s||!s.getCurrentPosition||!s.watchPosition)throw new Error("The provided geolocation provider is invalid");u&&(d.current=window.setTimeout(()=>{h()},u)),a?x.current=s.watchPosition(v,h,e):s.getCurrentPosition(v,h,e)},[s,a,u,h,v,e]);return(0,n.useEffect)(()=>{let o;return g&&s&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(j=>{o=j,o.onchange=()=>{N(o.state)}}).catch(j=>{console.error("Error updating the permissions",j)}),()=>{o&&(o.onchange=null)}},[]),(0,n.useEffect)(()=>(f||C(),()=>{p(),a&&x.current&&(s==null||s.clearWatch(x.current))}),[L]),{getPosition:C,coords:k,timestamp:A,isGeolocationEnabled:S,isGeolocationAvailable:!!s,positionError:_}}G=w.useGeolocated=I;const H=R.lazy(()=>D(()=>import("./MapContainerLeafets-Dw04F47a.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(({MapContainerLeafets:l})=>({default:l})));function J(){const l=M(),{coords:e,isGeolocationAvailable:m,isGeolocationEnabled:u,positionError:f,getPosition:a}=G({positionOptions:{enableHighAccuracy:!0},userDecisionTimeout:1/0,watchPosition:!0,watchLocationPermissionChange:!0}),s=[500,1e3,2e3,3e3,5e3],[g,r]=b.useState(500),c=i=>{i.preventDefault(),r(Number(i.target.value))};function d(){navigator.permissions.query({name:"geolocation"}).then(function(i){i.state=="granted"||i.state=="prompt"?(console.log(i.state),a()):i.state=="denied"&&console.log(i.state),i.onchange=function(){console.log(i.state)}})}return l?t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-4xl pt-4",children:"Tasks around you"}),t.jsxs("div",{className:"text-slate-400",children:["You are looking for tasks in"," ",t.jsx("select",{onChange:c,children:s.map(i=>t.jsx("option",{value:i,children:i},i))})," ","meters from you"]}),m?u?f?t.jsx("div",{children:"positionError"}):t.jsxs("div",{className:"flex-col hidden",children:[t.jsx("span",{children:"Geolocation is available"}),t.jsxs("span",{children:["Accuracy: ",e==null?void 0:e.accuracy]}),t.jsxs("span",{children:["Altitude: ",e==null?void 0:e.altitude]}),t.jsxs("span",{children:["Altitude accuracy: ",e==null?void 0:e.altitudeAccuracy]}),t.jsxs("span",{children:["Heading: ",e==null?void 0:e.heading]}),t.jsxs("span",{children:["Latitude: ",e==null?void 0:e.latitude]}),t.jsxs("span",{children:["Longitude: ",e==null?void 0:e.longitude]}),t.jsxs("span",{children:["Speed: ",e==null?void 0:e.speed]})]}):t.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[t.jsx("span",{children:"Geolocation not enabled"}),t.jsx("button",{className:"w-32 bg-slate-600 rounded-lg p-1 text-center select-none cursor-pointer hover:bg-slate-700",onClick:d,children:"Grant permission"})]}):t.jsx("div",{children:"Your browser doesnt support geolocation"}),e&&t.jsx(b.Suspense,{fallback:t.jsx("div",{className:"w-full h-[--tg-viewport-width] bg-slate-300 rounded-full overflow-hidden"}),children:t.jsx(H,{latitude:e.latitude,longitude:e.longitude,radius:g})})]}):t.jsx(O,{header:"Oops",description:"Application was launched with missing init data",children:t.jsx("img",{alt:"Telegram sticker",src:"https://xelene.me/telegram.gif",style:{display:"block",width:"144px",height:"144px"}})})}export{J as MapPage};
