const __vite__fileDeps=["./MapContainerYandex-Bac04Lgt.js","./index-BCoBUrtF.js","./index-BDL4_mI2.css","./MapContainerLeafets-t7Fnl3SP.js","./MapContainerGoogle-D32gkRkK.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as f,p as b,y as P,J as D,j as t,P as O}from"./index-BCoBUrtF.js";var E={};Object.defineProperty(E,"__esModule",{value:!0});var S=E.useGeolocated=void 0;const n=f;function I(a={}){const{positionOptions:e={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:m=!0,userDecisionTimeout:u=void 0,suppressLocationOnMount:x=!1,watchPosition:l=!1,geolocationProvider:s=typeof navigator<"u"?navigator.geolocation:void 0,watchLocationPermissionChange:d=!1,onError:r,onSuccess:c}=a,p=(0,n.useRef)(0),i=(0,n.useRef)(!0),v=(0,n.useRef)(0),[k,y]=(0,n.useState)(m),[A,_]=(0,n.useState)(),[T,M]=(0,n.useState)(),[N,C]=(0,n.useState)(),[L,R]=(0,n.useState)(),h=(0,n.useCallback)(()=>{p.current&&window.clearTimeout(p.current)},[]),g=(0,n.useCallback)(o=>{h(),i.current&&(_(()=>{}),y(!1),C(o)),r==null||r(o)},[r,h]),j=(0,n.useCallback)(o=>{h(),i.current&&(_(o.coords),M(o.timestamp),y(!0),C(()=>{})),c==null||c(o)},[c,h]),G=(0,n.useCallback)(()=>{if(!s||!s.getCurrentPosition||!s.watchPosition)throw new Error("The provided geolocation provider is invalid");u&&(p.current=window.setTimeout(()=>{g()},u)),l?v.current=s.watchPosition(j,g,e):s.getCurrentPosition(j,g,e)},[s,l,u,g,j,e]);return(0,n.useEffect)(()=>{let o;return d&&s&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(w=>{o=w,o.onchange=()=>{R(o.state)}}).catch(w=>{console.error("Error updating the permissions",w)}),()=>{o&&(o.onchange=null)}},[]),(0,n.useEffect)(()=>(x||G(),()=>{h(),l&&v.current&&(s==null||s.clearWatch(v.current))}),[L]),{getPosition:G,coords:A,timestamp:T,isGeolocationEnabled:k,isGeolocationAvailable:!!s,positionError:N}}S=E.useGeolocated=I;const Y=b.lazy(()=>P(()=>import("./MapContainerYandex-Bac04Lgt.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(({MapContainerYandex:a})=>({default:a}))),z=b.lazy(()=>P(()=>import("./MapContainerLeafets-t7Fnl3SP.js"),__vite__mapDeps([3,1,2]),import.meta.url).then(({MapContainerLeafets:a})=>({default:a}))),H=b.lazy(()=>P(()=>import("./MapContainerGoogle-D32gkRkK.js"),__vite__mapDeps([4,1,2]),import.meta.url).then(({MapContainerGoogle:a})=>({default:a})));function q(){const a=D(),{coords:e,isGeolocationAvailable:m,isGeolocationEnabled:u,positionError:x,getPosition:l}=S({positionOptions:{enableHighAccuracy:!0},userDecisionTimeout:1/0,watchPosition:!0,watchLocationPermissionChange:!0}),s=[500,1e3,2e3,3e3,5e3],[d,r]=f.useState(500),c=i=>{i.preventDefault(),r(Number(i.target.value))};function p(){navigator.permissions.query({name:"geolocation"}).then(function(i){i.state=="granted"||i.state=="prompt"?(console.log(i.state),l()):i.state=="denied"&&console.log(i.state),i.onchange=function(){console.log(i.state)}})}return a?t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-4xl pt-4",children:"Tasks around you"}),t.jsxs("div",{className:"text-slate-400",children:["You are looking for tasks in"," ",t.jsx("select",{onChange:c,children:s.map(i=>t.jsx("option",{value:i,children:i},i))})," ","meters from you"]}),m?u?x?t.jsx("div",{children:"positionError"}):t.jsxs("div",{className:"flex-col hidden",children:[t.jsx("span",{children:"Geolocation is available"}),t.jsxs("span",{children:["Accuracy: ",e==null?void 0:e.accuracy]}),t.jsxs("span",{children:["Altitude: ",e==null?void 0:e.altitude]}),t.jsxs("span",{children:["Altitude accuracy: ",e==null?void 0:e.altitudeAccuracy]}),t.jsxs("span",{children:["Heading: ",e==null?void 0:e.heading]}),t.jsxs("span",{children:["Latitude: ",e==null?void 0:e.latitude]}),t.jsxs("span",{children:["Longitude: ",e==null?void 0:e.longitude]}),t.jsxs("span",{children:["Speed: ",e==null?void 0:e.speed]})]}):t.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[t.jsx("span",{children:"Geolocation not enabled"}),t.jsx("button",{className:"w-32 bg-slate-600 rounded-lg p-1 text-center select-none cursor-pointer hover:bg-slate-700",onClick:p,children:"Grant permission"})]}):t.jsx("div",{children:"Your browser doesnt support geolocation"}),e&&t.jsxs("div",{className:"flex flex-col gap-7",children:[t.jsx(f.Suspense,{fallback:t.jsx("div",{className:"w-full h-[--tg-viewport-width] bg-slate-300 rounded-full overflow-hidden"}),children:t.jsx(Y,{latitude:e.latitude,longitude:e.longitude,radius:d})}),t.jsx(f.Suspense,{fallback:t.jsx("div",{className:"w-full h-[--tg-viewport-width] bg-slate-300 rounded-full overflow-hidden"}),children:t.jsx(H,{latitude:e.latitude,longitude:e.longitude,radius:d})}),t.jsx(f.Suspense,{fallback:t.jsx("div",{className:"w-full h-[--tg-viewport-width] bg-slate-300 rounded-full overflow-hidden"}),children:t.jsx(z,{latitude:e.latitude,longitude:e.longitude,radius:d})})]})]}):t.jsx(O,{header:"Oops",description:"Application was launched with missing init data",children:t.jsx("img",{alt:"Telegram sticker",src:"https://xelene.me/telegram.gif",style:{display:"block",width:"144px",height:"144px"}})})}export{q as MapPage};
