const __vite__fileDeps=["./GeolocationRequest-7H_hP6we.js","./index-BUIFIREP.js","./index-lNRkx6TD.css","./Input-9a2PHrOu.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{b as J,c as C,s as le,N as V,r as n,j as e,C as o,O as H,R as ae,_ as ne,Q as S,U as ie,V as ce,m as oe,W as re,d as de,B as he,E as me,T as ue}from"./index-BUIFIREP.js";import{L as q,Z as ge,I as xe,a as k,M as pe}from"./index-C0fbcPTu.js";import{M as fe,F as G,b as je}from"./GeolocationRequest-7H_hP6we.js";import{L as Z,C as b,B as E,I as R}from"./Input-9a2PHrOu.js";import{I as Q,F as ve}from"./FileInput-CMGqtNf-.js";import{A as Ne}from"./Avatar-BHWnWOiv.js";const F=a=>Number(a)*Math.PI/180,we=(a,h)=>{if(!a||!h)return 0;const m=6378.137,t=F(h.latitude)-F(a.latitude),l=F(h.longitude)-F(a.longitude),p=Math.sin(t/2)*Math.sin(t/2)+Math.cos(F(a.latitude))*Math.cos(F(h.latitude))*Math.sin(l/2)*Math.sin(l/2),f=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),j=m*f;return Number(j.toFixed(3))},be=({taskId:a,closeModal:h})=>{var A,u,D,L;const m=J(),t=C(le),l=C(r=>V(r,a)),[p,f]=n.useState(!1),[j,d]=n.useState(0),g=r=>{console.log("Open image fullscreen. Index: "+r),f(!0),d(r)},v=()=>{console.log("Close image fullscreen"),f(!1),d(0)},[y,c]=n.useState(!1),[I,N]=n.useState(!1),M=async r=>{l&&(r.preventDefault(),console.log("Clicked accept"),c(!0),setTimeout(()=>{console.log("Do something after 2 secs"),m(H({id:l.id,status:"active",userId:t.id})),c(!1),h()},2e3))},x=async r=>{l&&(r.preventDefault(),console.log("Clicked dismiss"),N(!0),await setTimeout(()=>{console.log("Do something after 5 secs"),m(H({id:l.id,status:"open",userId:""})),N(!1),h()},2e3))};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Title"}),e.jsx(b,{children:l.title})]}),e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Description"}),e.jsx(b,{children:l.desc})]}),e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Reward"}),e.jsx(b,{children:e.jsx("span",{children:l.reward})})]}),l.attachments&&l.attachments.length>0&&e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Attachments"}),e.jsx("div",{className:"p-2 grid grid-flow-row grid-cols-3 gap-2",children:l.attachments.map((r,T)=>e.jsx(Q,{size:96,src:r,onClick:()=>g(T)},T+r))})]}),e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Customer"}),e.jsx(b,{children:e.jsx("span",{children:l.customer})})]}),e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Address"}),e.jsx(b,{children:(A=l.location.address)==null?void 0:A.formattedAdress})]}),e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"On map"}),e.jsx(b,{children:e.jsx(fe,{available:l.location.available,type:"target",center:{latitude:Number((u=l.location.latLong)==null?void 0:u.latitude),longitude:Number((D=l.location.latLong)==null?void 0:D.longitude)}})})]})]}),e.jsxs("div",{className:"w-full flex justify-around pb-8",children:[l.status==="open"&&e.jsx(E,{className:"bg-green-600 w-2/6",onClick:M,loading:y,children:"Accept"}),l.status==="active"&&e.jsx(E,{className:"bg-red-600 w-2/6",onClick:x,loading:I,children:"Decline"})]}),e.jsx(q,{open:p,controller:{closeOnPullDown:!0,closeOnBackdropClick:!0,closeOnPullUp:!0},close:v,index:j,plugins:[ge],slides:(L=l==null?void 0:l.attachments)==null?void 0:L.map(r=>({src:r}))})]})},Ce=ae.lazy(()=>ne(()=>import("./GeolocationRequest-7H_hP6we.js").then(a=>a.c),__vite__mapDeps([0,1,2,3]),import.meta.url).then(({MapContainerYandex:a})=>({default:a}))),Te=({taskId:a,endEditing:h})=>{var _,Y;const m=J(),t=C(s=>V(s,a)),[l,p]=n.useState(!1),[f,j]=n.useState(!1),[d,g]=n.useState((t==null?void 0:t.title)||""),[v,y]=n.useState((t==null?void 0:t.desc)||""),[c,I]=n.useState((t==null?void 0:t.reward.split(" ")[0])||""),[N,M]=n.useState(t==null?void 0:t.reward.split(" ")[1]),[x,A]=n.useState((t==null?void 0:t.attachments)||[]),[u,D]=n.useState((t==null?void 0:t.location)||{available:!1}),L=n.useCallback(()=>{var i,w;const s=JSON.parse(sessionStorage.getItem("edited-task-"+a)||"{}");try{g(s.title),y(s.desc),I(((i=s==null?void 0:s.reward)==null?void 0:i.split(" ")[0])||""),M((w=s==null?void 0:s.reward)==null?void 0:w.split(" ")[1]),A(s.attachments||[]),D(s.location)}catch{console.log("Cant parse saved task")}},[a]),r=n.useCallback(()=>{if(t)return{...t,title:d,desc:v,reward:c+" "+N,attachments:x,location:u}},[t,d,v,c,N,x,u]),[T,O]=n.useState(C(s=>S(s,a)));n.useEffect(()=>{T&&(console.log("Restore edited task"),L())},[]),n.useEffect(()=>{d.trim()!==(t==null?void 0:t.title)||v.trim()!==t.desc||c.trim()!==t.reward.split(" ")[0]||(N||"").trim()!==t.reward.split(" ")[1]||x!==t.attachments||u!==t.location?(console.log("Changes made"),O(!0)):(console.log("No changes"),O(!1))},[t,d,v,c,N,x,u]),n.useEffect(()=>{T?(console.log("Add edited task to session storage"),sessionStorage.setItem("edited-task-"+a,JSON.stringify(r())),console.log("Add edited task in changes state"),m(ie(a))):(console.log("Remove edited task from session storage"),sessionStorage.removeItem("edited-task-"+a),console.log("Remove edited task from changes state"),m(ce(a))),f&&h()},[a,T,m,r,f,h]);const W=s=>{const i=s.currentTarget.files;if(i&&(i==null?void 0:i.length)>0){const w=[];for(let B=0;B<i.length;B++)w.push(URL.createObjectURL(i[B]));A([...x||[],...w])}},z=s=>{const i=[...x];i.splice(s,1),A(i)},X=()=>{const s=document.getElementsByTagName("input");for(let w=0;w<s.length;w++)s[w].blur();if(d.trim().length===0||v.trim().length===0||c.length===0||(N||"")===""||!u.available)return p(!0);const i=r();i&&(m(re(i)),O(!1),j(!0))},$=()=>{O(!1),j(!0)},[K,U]=n.useState(!1),[ee,P]=n.useState(0),se=s=>{console.log("Open image fullscreen. Index: "+s),U(!0),P(s)},te=()=>{U(!1),P(0)};return e.jsxs("div",{children:[e.jsxs("div",{children:[T&&e.jsx("div",{className:"bg-yellow-400 text-center rounded-lg mb-1",children:"You have uncommited changes!!!"}),e.jsxs(Z,{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{children:[e.jsxs(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Title",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(R,{value:d,status:d.length===0&&l?"error":"default",placeholder:"Title...",onChange:s=>{const i=s.currentTarget.value;g(i)}}),e.jsx(o,{className:"pl-8 text-red-400",hidden:!(d.length===0&&l),children:"This field cant be empty"})]}),e.jsxs("div",{children:[e.jsxs(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Description",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(R,{placeholder:"Description...",value:v,status:v.length===0&&l?"error":"default",onChange:s=>y(s.currentTarget.value)}),e.jsx(o,{className:"pl-8 text-red-400",hidden:!(v.length===0&&l),children:"This field cant be empty"})]}),e.jsxs("div",{children:[e.jsxs(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Reward",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"flex items-center justify-stretch h-fit",children:[e.jsxs("div",{className:"w-2/5 h-full flex flex-col justify-between",children:[e.jsx(R,{placeholder:"Cost...",inputMode:"numeric",type:"number",status:c.length===0&&l?"error":"default",value:c||"",onChange:s=>{I(s.currentTarget.value)}}),e.jsx(o,{className:"pl-8 text-red-400",hidden:!(c.length===0&&l),children:"This field cant be empty"})]}),e.jsxs("div",{className:"w-3/5 flex flex-col h-full justify-between",children:[e.jsxs(xe,{className:"h-12 items-center",children:[e.jsx(k,{onClick:()=>M("TON"),mode:N==="TON"?"bezeled":"plain",children:"TON"}),e.jsx(k,{onClick:()=>M("USDT"),mode:N==="USDT"?"bezeled":"plain",children:"USDT"}),e.jsx(k,{onClick:()=>M("BTC"),mode:N==="BTC"?"bezeled":"plain",children:"BTC"})]}),e.jsx(o,{className:"pl-8 text-red-400",hidden:!((N||"")===""&&l),children:"Please select currency"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Attachments"}),e.jsx("div",{className:"p-2 grid grid-flow-row grid-cols-4 gap-2",children:x.map((s,i)=>e.jsxs("div",{className:"relative",children:[e.jsx(Q,{size:96,className:"w-full",src:s,onClick:()=>se(i)}),e.jsx(G,{className:"absolute right-0 -top-2 w-6 h-6 border border-gray-500 rounded-full bg-gray-400 bg-opacity-55",onClick:()=>z(i)})]},i+"/"+s))}),x&&x.length>0&&x.map((s,i)=>e.jsx(b,{className:"pl-6",after:e.jsx(E,{mode:"plain",onClick:()=>z(i),children:"X"}),children:e.jsx(oe,{children:s})},i+s)),e.jsx(ve,{multiple:!0,label:"Attach a new file",accept:"image/*",onChange:W})]}),e.jsxs("div",{children:[e.jsxs(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Address",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"overflow-visible",children:[e.jsx(je,{status:!u.available&&l?"error":"default",geoposition:u||{available:!1},setGeoposition:s=>D(s)}),e.jsx(o,{className:"pl-8 text-red-400",hidden:!(!u.available&&l),children:"Oops..."})]})]}),e.jsxs("div",{children:[e.jsx(o,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"On map"}),e.jsx(b,{children:e.jsx(Ce,{available:u.available,type:"target",center:{latitude:Number((_=u.latLong)==null?void 0:_.latitude),longitude:Number((Y=u.latLong)==null?void 0:Y.longitude)}})})]})]})]}),e.jsx("div",{className:"sticky bottom-0 pt-8",children:e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx(E,{className:"bg-green-400 w-full",onClick:X,children:"Save"}),e.jsx(E,{className:"bg-red-400 w-full",onClick:$,children:"Cancel"})]})}),e.jsx(q,{open:K,close:te,controller:{closeOnPullDown:!0,closeOnBackdropClick:!0,closeOnPullUp:!0},index:ee,slides:x.map(s=>({src:s}))})]})},Oe=({task:a,mode:h})=>{const m=C(de),t=C(c=>S(c,a.id)),[l,p]=n.useState(!1),[f,j]=n.useState(!1),d=()=>{p(!0),console.log("Modal opened")},g=()=>{j(!0)},[v,y]=n.useState();return n.useEffect(()=>{var c;y(we((c=a.location)==null?void 0:c.latLong,m.latLong))},[m,a]),e.jsxs(e.Fragment,{children:[e.jsx(b,{before:e.jsx(Ne,{children:"CS"}),id:a.id,className:"w-full select-none",multiline:!1,description:a.desc,after:e.jsx("span",{children:a.reward}),titleBadge:t?e.jsx(he,{className:"bg-yellow-600",mode:"critical",type:"number",children:"!"}):e.jsx(e.Fragment,{}),subhead:v+" km",onClick:d,children:a.title}),l&&e.jsxs("div",{id:"pseudoModal",hidden:!l,className:"w-screen fixed top-[15%] bottom-0 bg-[--tg-theme-bg-color] overflow-y-scroll".concat(" ",f?"animate-bottomDisappear":"animate-bottomAppear"," ",l?"z-10":"-z-10"),style:{animationFillMode:"forward"},onAnimationEnd:()=>{if(f){const c=document.getElementById("pseudoModal");c&&(c.style.opacity="0"),p(!1),j(!1),console.log("Modal closed")}},children:[e.jsx("div",{className:"sticky -top-0 inset-0 z-[11] bg-[--tg-theme-bg-color]",children:e.jsx(pe,{after:e.jsx(G,{className:"text-[--tg-theme-plain-foreground] h-4",onClick:g})})}),e.jsx(ye,{taskId:a.id,closeModal:g,mode:h})]})]})},ye=({taskId:a="-1",closeModal:h,mode:m})=>{const[t,l]=n.useState(C(g=>S(g,a))),p=C(g=>S(g,a)),[f,j]=n.useState(!1),d=()=>{p&&j(!0),p||l(g=>!g)};return a?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[e.jsx(ue,{className:"text-center",children:"Task details"}),m==="edit"&&e.jsx(E,{mode:"plain",onClick:d,className:f?"animate-jiggle text-red-400":"",onAnimationEnd:()=>{j(!1)},children:"Edit"})]}),!t&&e.jsx("div",{children:e.jsx(be,{taskId:a,closeModal:h})}),t&&e.jsx("div",{children:e.jsx(Te,{taskId:a,endEditing:()=>l(!1)})})]}):e.jsx(me,{children:"No passed task id"})};export{ye as T,Oe as a};
