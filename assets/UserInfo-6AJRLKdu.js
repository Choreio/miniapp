import{b as T,r as t,c as g,i as S,s as F,d as B,e as O,j as a,E as _,T as J,C as f,B as M,f as P,h as R}from"./index-B8PaqVDj.js";import{B as b,L as G,S as x,C as d}from"./Section-CeaKGj3Z.js";import{F as z}from"./FileInput-BzuWWlvH.js";import{A as H}from"./Avatar-T3LGyO6b.js";import{I as K}from"./Input-4T3ny2QZ.js";import"./VisuallyHidden-BaflBciP.js";const W="/miniapp/assets/avatar_placeholder_black-DRyce69K.png",Y="/miniapp/assets/avatar_placeholder_white-CbxutB7M.png",N=[{sector:"personal",name:"photoUrl",displayName:"Avatar",editable:!0},{sector:"personal",name:"username",displayName:"Username",editable:!0},{sector:"personal",name:"email",displayName:"Email",editable:!0},{sector:"personal",name:"firstName",displayName:"First name",editable:!0},{sector:"personal",name:"lastName",displayName:"Last name",editable:!0},{sector:"system",name:"id",displayName:"Inner ID",editable:!1},{sector:"system",name:"tg_id",displayName:"Telegram ID",editable:!1},{sector:"others",name:"languageCode",displayName:"Locale",editable:!1},{sector:"others",name:"role",displayName:"User Role",editable:!1}],$=[{sector:"geolocation",name:"available",displayName:"Geoposition enabled",editable:!1},{sector:"geolocation",name:"latitude",displayName:"Latitude",editable:!1},{sector:"geolocation",name:"longitude",displayName:"Longitude",editable:!1},{sector:"geolocation",name:"formattedAdress",displayName:"FormattedAddress",editable:!1},{sector:"geolocation",name:"country",displayName:"Country name",editable:!1},{sector:"geolocation",name:"city",displayName:"City name",editable:!1},{sector:"geolocation",name:"street",displayName:"Street name",editable:!1},{sector:"geolocation",name:"house",displayName:"House No",editable:!1}],ae=()=>{const y=T(),[m,u]=t.useState(g(S)),[n,h]=t.useState(g(S)),o=g(F),E=JSON.parse(sessionStorage.getItem("saved-user")||"{}"),[s,i]=t.useState(n?E:o),c=g(B),[U,k]=t.useState({available:c.available,...c.latLong,...c.address});t.useEffect(()=>{k({available:c.available,...c.latLong,...c.address})},[c]);const[j,v]=t.useState([]);t.useEffect(()=>{y(O(n))},[n,y]),t.useEffect(()=>{s&&(JSON.stringify(o)!==JSON.stringify(s)?(sessionStorage.setItem("saved-user",JSON.stringify(s)),v(N.map(e=>s[e.name]!==o[e.name]?e.name:"")),h(!0)):(h(!1),sessionStorage.removeItem("saved-user"),v([])))},[s,o]),t.useEffect(()=>{n||(console.log("Sync user"),i(o))},[o,n]);const[w,C]=t.useState(!1),I=e=>{e.preventDefault(),console.log("Edit mode handler"),u(!0),n&&C(!0),m&&!n&&u(!1)},L=e=>{if(s){e.preventDefault(),console.log("Avatar change");const l=e.currentTarget.files;l&&i({...s,photoUrl:URL.createObjectURL(l[0])})}},A=e=>{s&&(e.preventDefault(),console.log("Changes saved"),y(R(s)),u(!1),h(!1))},D=e=>{e.preventDefault(),console.log("Changes canceled"),i(o),u(!1),h(!1)},[r,p]=t.useState(!1);return s?a.jsxs("div",{className:"md:container md:mx-auto",children:[n&&a.jsx("div",{className:"bg-yellow-400 text-center rounded-lg mb-1",children:"You have uncommited changes!!!"}),a.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[a.jsx(J,{children:"My profile"}),a.jsx(b,{mode:"plain",onClick:I,className:w?"animate-jiggle text-red-400":"",onAnimationEnd:()=>{C(!1)},children:"Edit"})]}),a.jsxs(G,{className:"flex flex-col h-full gap-8",children:[a.jsx(x,{header:"Personal Info",children:N.filter(e=>e.sector==="personal").map(e=>a.jsxs("div",{children:[a.jsx(f,{level:"1",weight:"2",className:"p-6 text-[--tg-theme-hint-color]",children:e.displayName}),e.name==="photoUrl"&&a.jsxs(d,{after:e.editable&&m&&a.jsx(z,{id:"input_file",onChange:L,accept:"image/png, image/jpeg"}),children:[j.includes(e.name)&&a.jsx(M,{type:"number",mode:"critical",large:!0,className:"absolute left-2 top-2 z-10",children:"Edited"}),a.jsx(H,{size:96,src:s.photoUrl?s.photoUrl:P.isDark()?Y:W})]}),e.name!=="photoUrl"&&a.jsx(a.Fragment,{children:m&&e.editable?a.jsx(K,{readOnly:!(m&&e.editable),status:j.includes(e.name)?"error":"default",inputMode:"text",placeholder:e.displayName,value:s[e.name],onChange:l=>{switch(e.name){case"username":i({...s,username:l.currentTarget.value});break;case"email":i({...s,email:l.currentTarget.value});break;case"firstName":i({...s,firstName:l.currentTarget.value});break;case"lastName":i({...s,lastName:l.currentTarget.value});break}}}):a.jsx(d,{multiline:r,onClick:()=>p(!r),children:s[e.name]})})]},e.name))}),a.jsx(x,{header:"System Info",children:N.filter(e=>e.sector==="system").map(e=>a.jsxs("div",{children:[a.jsx(f,{level:"1",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:e.displayName}),a.jsx(d,{multiline:r,onClick:()=>p(!r),children:s[e.name]})]},e.name))}),a.jsx(x,{header:"Other Info",children:N.filter(e=>e.sector==="others").map(e=>a.jsxs("div",{children:[a.jsx(f,{level:"1",weight:"2",className:"p-6 text-[--tg-theme-hint-color]",children:e.displayName}),a.jsx(d,{multiline:r,onClick:()=>p(!r),children:s[e.name]})]},e.name))}),a.jsx(x,{header:"Geolocation Info",children:$.map(e=>{var l;return a.jsxs("div",{children:[a.jsx(f,{level:"1",weight:"2",className:"p-6 text-[--tg-theme-hint-color]",children:e.displayName}),a.jsx(d,{multiline:r,onClick:()=>p(!r),children:(l=U[e.name])==null?void 0:l.toString()})]},e.name)})})]}),m&&a.jsx("div",{className:"sticky bottom-24 pl-4 pr-4",children:a.jsxs("div",{className:"flex flex-row justify-center items-center",children:[a.jsx(b,{className:"bg-green-400 w-full",onClick:A,children:"Confirm"}),a.jsx(b,{className:"bg-red-400 w-full",onClick:D,children:"Cancel"})]})})]}):a.jsx(_,{children:"Something went wrong with user"})};export{ae as UserInfo};
