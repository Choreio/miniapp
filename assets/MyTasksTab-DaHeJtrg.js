const __vite__fileDeps=["./MapPage-CTM5CB-N.js","./index-DO2_rIAT.js","./index-BywDTP46.css","./GeolocationRequest-CVe1YDTx.js","./Input-DrR5Hm1P.js","./TaskCard-CU8pSPsc.js","./ModalHeader-Ch4pk0Mu.js","./Avatar-CloWoUGH.js","./FileInput-oC7ynekZ.js","./TasksList-BGUmy_77.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as t,k as F,l as P,j as e,m as ae,n as z,o as le,C as h,p as U,q,v as ne,c as C,s as H,b as oe,w as V,x as ce,T as G,y as re,z as ie,R as J,_ as Z,h as de,d as he,B as me}from"./index-DO2_rIAT.js";import{b as ue,M as xe,G as pe,S as ge,a as B}from"./GeolocationRequest-CVe1YDTx.js";import{L as fe,I as _,C as R,B as I,S as je}from"./Input-DrR5Hm1P.js";import{F as ve}from"./FileInput-oC7ynekZ.js";import{M as be}from"./ModalHeader-Ch4pk0Mu.js";const X=t.createContext({}),Ne={bezeled:"tgui-99a630d0096f2169",gray:"tgui-30bf4976f818e8bf"},M=n=>{var{mode:m="plain",className:d,text:l,children:j}=n,c=F(n,["mode","className","text","children"]);const g=P(),{mode:o}=t.useContext(X),v=o||m;return e.jsxs(ae,z(U({Component:"button",className:q("tgui-c5545e0bc6105e48",g==="ios"&&"tgui-bf32cd3c110b8729",v!=="plain"&&Ne[v],d)},c),{children:[j,le(l)&&e.jsx(h,{className:"tgui-c0c9bf3b1a53a8a4",level:"1",weight:"2",children:l})]}))},Y=t.forwardRef((n,m)=>{var{mode:d,className:l,children:j}=n,c=F(n,["mode","className","children"]);const g=P(),o=ne({mode:d});return e.jsx("div",z(U({ref:m,className:q("tgui-39e9f02ce4b4b950",g==="ios"&&"tgui-b3d7f75461a64b76",l)},c),{children:e.jsx(X.Provider,{value:o,children:j})}))});Y.Item=M;function Ce({title:n,titleId:m,...d},l){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":m},d),n?t.createElement("title",{id:m},n):null,t.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z",clipRule:"evenodd"}))}const we=t.forwardRef(Ce),Te=({closeModal:n})=>{var E,O;const m=C(H),d=oe(),[l,j]=t.useState(!1),[c,g]=t.useState(""),[o,v]=t.useState(""),[f,b]=t.useState(""),[r,N]=t.useState(),[u,w]=t.useState([]),[i,T]=t.useState({available:!1}),x=t.useMemo(()=>m.id,[m]),K=()=>{var a,p;const s=JSON.parse(sessionStorage.getItem("saved-task")||"{}");try{g(s.title),v(s.desc),b(((a=s==null?void 0:s.reward)==null?void 0:a.split(" ")[0])||""),N((p=s==null?void 0:s.reward)==null?void 0:p.split(" ")[1]),w(s.attachments||[]),T(s.location)}catch{console.log("Cant parse saved task")}},y=t.useCallback((s,a,p,L,k,se,te)=>({id:Date.now().toString(),title:s,desc:a,reward:p+" "+L,attachments:k,location:se,customer:te,status:"open"}),[]),[A,S]=t.useState(C(V));t.useEffect(()=>{A&&(console.log("Restore created task"),K())},[]),t.useEffect(()=>{c.trim()!==""||o.trim()!==""||f.trim()!==""||(r||"").trim()!==""||u.length>0||i.available?(console.log("Changes made"),S(!0),sessionStorage.setItem("saved-task",JSON.stringify(y(c,o,f,r||"TON",u,i,x)))):(S(!1),sessionStorage.removeItem("saved-task"))},[c,o,f,r,u,i,x,y]),t.useEffect(()=>{console.log("Update changes store"),d(ce(A))},[A,d]);const Q=s=>{const a=s.currentTarget.files;if(a&&(a==null?void 0:a.length)>0){const p=[];for(let k=0;k<a.length;k++)p.push(URL.createObjectURL(a[k]));w([...u||[],...p])}},W=s=>{const a=[...u];a.splice(s,1),w(a)},$=()=>{const s=document.getElementsByTagName("input");for(let p=0;p<s.length;p++)s[p].blur();if(c.trim().length===0||o.trim().length===0||f.length===0||(r||"")===""||!i.available)return j(!0);const a=y(c,o,f,r||"TON",u,i,x);d(ie(a)),S(!1),sessionStorage.removeItem("created-task"),n()},ee=()=>{S(!1),sessionStorage.removeItem("created-task"),n()};return e.jsxs("div",{children:[e.jsx("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:e.jsx(G,{children:"Task creation"})}),e.jsx("div",{children:e.jsxs(fe,{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{children:[e.jsxs(h,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Title",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(_,{value:c,status:c.length===0&&l?"error":"default",placeholder:"Title...",onChange:s=>{const a=s.currentTarget.value;g(a)}}),e.jsx(h,{className:"pl-8 text-red-400",hidden:!(o.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(h,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Description",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(_,{placeholder:"Description...",value:o,status:o.length===0&&l?"error":"default",onChange:s=>v(s.currentTarget.value)}),e.jsx(h,{className:"pl-8 text-red-400",hidden:!(o.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(h,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Reward",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"flex items-center justify-stretch h-fit",children:[e.jsxs("div",{className:"w-2/5 h-full flex flex-col justify-between",children:[e.jsx(_,{placeholder:"Cost...",inputMode:"numeric",type:"number",status:f.length===0&&l?"error":"default",value:f||"",onChange:s=>{b(s.currentTarget.value)}}),e.jsx(h,{className:"pl-8 text-red-400",hidden:!(o.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{className:"w-3/5 flex flex-col h-full justify-between",children:[e.jsxs(Y,{className:"h-12 items-center",children:[e.jsx(M,{onClick:()=>N("TON"),mode:r==="TON"?"bezeled":"plain",children:"TON"}),e.jsx(M,{onClick:()=>N("USDT"),mode:r==="USDT"?"bezeled":"plain",children:"USDT"}),e.jsx(M,{onClick:()=>N("BTC"),mode:r==="BTC"?"bezeled":"plain",children:"BTC"})]}),e.jsx(h,{className:"pl-8 text-red-400",hidden:!((r||"")===""&&l),children:"Please select currency"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Attachments"}),u&&u.length>0&&u.map((s,a)=>e.jsx(R,{className:"pl-6",after:e.jsx(I,{mode:"plain",onClick:()=>W(a),children:"X"}),children:e.jsx(re,{children:s})},a+s)),e.jsx(ve,{multiple:!0,label:"Attach a new file",accept:"image/*",onChange:Q})]}),e.jsxs("div",{children:[e.jsxs(h,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Address",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"overflow-visible",children:[e.jsx(ue,{status:!i.available&&l?"error":"default",geoposition:i||{available:!1},setGeoposition:s=>T(s)}),e.jsx(h,{className:"pl-8 text-red-400",hidden:!(o.length===0&&l),children:"This field is required"})]})]}),i.available&&e.jsxs("div",{children:[e.jsx(h,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"On map"}),e.jsx(R,{children:e.jsx(xe,{type:"target",center:{latitude:Number((E=i.latLong)==null?void 0:E.latitude),longitude:Number((O=i.latLong)==null?void 0:O.longitude)}})})]})]})}),e.jsx("div",{className:"sticky bottom-0 pt-8",children:e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx(I,{className:"bg-green-400 w-full",onClick:$,children:"Create"}),e.jsx(I,{className:"bg-red-400 w-full",onClick:ee,children:"Cancel"})]})})]})},ke=J.lazy(()=>Z(()=>import("./MapPage-CTM5CB-N.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url).then(({MapPage:n})=>({default:n}))),D=J.lazy(()=>Z(()=>import("./TasksList-BGUmy_77.js"),__vite__mapDeps([9,1,2,4,5,6,3,7,8]),import.meta.url).then(({TasksList:n})=>({default:n}))),Re=()=>{const[n,m]=t.useState("list"),d=x=>{console.log("Changing mode"),m(x)},[l,j]=t.useState(!1),[c,g]=t.useState(!1),o=C(V),v=()=>{j(!0),console.log("Modal opened")},f=()=>{g(!0)},b=C(H),r=C(de),N=t.useMemo(()=>r.filter(x=>x.customer===b.id&&x.status!=="closed"),[r,b]),u=t.useMemo(()=>r.filter(x=>x.customer===b.id&&x.status==="closed"),[r,b]),[w,i]=t.useState(!0);t.useEffect(()=>{console.log("Force redo accordeon"),i(!1),setTimeout(()=>{i(!0)},50)},[r]);const T=C(he);return T.available?e.jsxs("div",{className:"md:container md:mx-auto",children:[e.jsx(je,{className:"pt-4 h-full",header:e.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[e.jsx(G,{className:"self-start",children:"Tasks"}),e.jsxs(ge,{className:"w-40 h-8 self-end ",children:[e.jsx(B,{className:"w-4 h-8 align-middle p-1",onClick:()=>{d("list")},children:"List"}),e.jsx(B,{className:"w-4 h-8 align-middle p-1",onClick:()=>{d("map")},children:"Map"})]})]}),children:n==="list"?e.jsxs(e.Fragment,{children:[e.jsx(R,{disabled:c,before:e.jsxs("div",{children:[e.jsx(we,{className:"h-8 w-8"}),o&&e.jsx(me,{className:"absolute top-1 right-1 bg-yellow-600",type:"number",children:"!"})]}),onClick:v,children:"Create a new task"}),e.jsx(D,{title:"Active tasks",tasks:N,mode:"edit",open:w}),e.jsx(D,{title:"Finished tasks",tasks:u,mode:"view"})]}):e.jsx(e.Fragment,{children:e.jsx(ke,{parent:"MyTasks",tasks:N,position:T})})}),e.jsxs("div",{hidden:!l,className:"fixed top-0 bottom-0 bg-[--tg-theme-bg-color] overflow-scroll".concat(" ",c?"animate-bottomDisappear":"animate-bottomAppear"," ",l?"z-10":"-z-10"),onAnimationEnd:()=>{c&&(j(!1),g(!1),console.log("Modal closed"))},children:[e.jsx(be,{}),e.jsx(Te,{openModal:l,closeModal:f})]})]}):e.jsx(pe,{})};export{Re as MyTasksTab};
