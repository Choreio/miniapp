import{u as Y,d as O,s as Z,c as H,r as n,M as Q,N as x,j as s,T as X,C as l,Q as K,x as V,U as W}from"./index-DJ6RCx2I.js";import{G as _,M as $}from"./MapContainerYandex-nxPwLwiQ.js";import{I as ee,a as F,L as se,Z as te}from"./index-CU0eW6TE.js";import{B as u,L as ae,S as le,C as U}from"./Section-GC_IaaTE.js";import{I as p}from"./Input-kGKCPJP_.js";import{I as re,F as ce}from"./FileInput-Do1c2iQw.js";import"./VisuallyHidden-BUI1MQ4o.js";const xe=()=>{var k,C,b,T,y,I,S;const f=Y(),g=O(Z),o=H(),[r,A]=n.useState(!1),[e,c]=n.useState({id:"",status:"open",title:"",desc:"",reward:{cost:0,currency:void 0},attachments:[],location:void 0,customer:{id:g.id,name:(g.firstName+" "+g.lastName||"").trim()}}),D=()=>{const t=JSON.parse(sessionStorage.getItem("saved-task")||"{}");try{c(t)}catch{console.log("Cant parse saved task")}},j=n.useCallback((t,a,i,h,G,P,J)=>({id:Date.now().toString(),title:t,desc:a,reward:{cost:i,currency:h},attachments:G,location:P,customer:J,status:"open"}),[]),[d,m]=n.useState(O(Q));n.useEffect(()=>{d&&(console.log("Restore created task"),D())},[d]),n.useEffect(()=>{var t,a;console.log(e),e.title.trim()!==""||e.desc.trim()!==""||e.reward.cost!==0||(e.reward.currency||"").trim()!==""||(((t=e==null?void 0:e.attachments)==null?void 0:t.length)||0)>0||(a=e==null?void 0:e.location)!=null&&a.available?(console.log("Changes made"),m(!0),sessionStorage.setItem("saved-task",JSON.stringify(j(e.title,e.desc,e.reward.cost,e.reward.currency,e.attachments,e.location,e.customer)))):(m(!1),sessionStorage.removeItem("saved-task"))},[e,j]),n.useEffect(()=>{console.log("Update changes store"),o(x(d))},[d,o]);const L=t=>{const a=t.currentTarget.files;if(a&&(a==null?void 0:a.length)>0){const i=[];for(let h=0;h<a.length;h++)i.push(URL.createObjectURL(a[h]));c({...e,attachments:[...e.attachments||[],...i]})}},v=t=>{const a=[...e.attachments||[]];a.splice(t,1),c({...e,attachments:a})},B=()=>{var a;const t=document.getElementsByTagName("input");for(let i=0;i<t.length;i++)t[i].blur();if(e.title.trim().length===0||e.desc.trim().length===0||e.reward.cost===0||!((e.reward.currency||"")in["TON","USDT"])||!((a=e.location)!=null&&a.available))return A(!0);o(W(e)),m(!1),o(x(!1)),sessionStorage.removeItem("created-task"),f("/tasks/task/"+e.id)},E=()=>{m(!1),o(x(!1)),sessionStorage.removeItem("saved-task"),f("/tasks/all/list")},[R,N]=n.useState(!1),[q,w]=n.useState(0),M=t=>{console.log("Open image fullscreen. Index: "+t),N(!0),w(t)},z=()=>{console.log("Close image fullscreen"),N(!1),w(0)};return s.jsxs("div",{children:[d&&s.jsx("div",{className:"bg-yellow-400 text-center rounded-lg mb-1",children:"You have uncommited changes!!!"}),s.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[s.jsx(X,{children:"Task creation"}),s.jsx(u,{mode:"plain",onClick:()=>history.back(),children:"Back"})]}),s.jsx(ae,{className:"flex flex-col gap-2 h-full",children:s.jsxs(le,{children:[s.jsxs("div",{children:[s.jsxs(l,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Title",s.jsx("span",{className:"text-red-600",children:"*"})]}),s.jsx(p,{value:e.title,status:e.title.length===0&&r?"error":"default",placeholder:"Title...",onChange:t=>{c({...e,title:t.currentTarget.value})}}),s.jsx(l,{className:"pl-8 text-red-400",hidden:!(e.title.length===0&&r),children:"This field is required"})]}),s.jsxs("div",{children:[s.jsxs(l,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Description",s.jsx("span",{className:"text-red-600",children:"*"})]}),s.jsx(p,{placeholder:"Description...",value:e.desc,status:e.desc.length===0&&r?"error":"default",onChange:t=>c({...e,desc:t.currentTarget.value})}),s.jsx(l,{className:"pl-8 text-red-400",hidden:!(e.desc.length===0&&r),children:"This field is required"})]}),s.jsxs("div",{children:[s.jsxs(l,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Reward",s.jsx("span",{className:"text-red-600",children:"*"})]}),s.jsxs("div",{className:"flex items-center justify-stretch h-fit",children:[s.jsxs("div",{className:"w-2/5 h-full flex flex-col justify-between",children:[s.jsx(p,{placeholder:"Cost...",inputMode:"numeric",type:"number",status:e.reward.cost===0&&r?"error":"default",value:e.reward.cost||"",onChange:t=>{c({...e,reward:{...e.reward,cost:Number(t.currentTarget.value)}})}}),s.jsx(l,{className:"pl-8 text-red-400",hidden:!(e.reward.cost===0&&r),children:"This field is required"})]}),s.jsxs("div",{className:"w-3/5 flex flex-col h-full justify-between",children:[s.jsxs(ee,{className:"h-12 items-center",children:[s.jsx(F,{onClick:()=>{c({...e,reward:{...e.reward,currency:"TON"}})},mode:e.reward.currency==="TON"?"bezeled":"plain",children:"TON"}),s.jsx(F,{onClick:()=>{c({...e,reward:{...e.reward,currency:"USDT"}})},mode:e.reward.currency==="USDT"?"bezeled":"plain",children:"USDT"})]}),s.jsx(l,{className:"pl-8 text-red-400",hidden:!(!(e.reward.currency||""in["TON","USDT"])&&r),children:"Please select currency"})]})]})]}),s.jsxs("div",{children:[s.jsx(l,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Attachments"}),s.jsx("div",{className:"p-2 grid grid-flow-row grid-cols-4 gap-2",children:e.attachments&&e.attachments.map((t,a)=>s.jsxs("div",{className:"relative",children:[s.jsx(re,{size:96,className:"w-full",src:t,onClick:()=>M(a)}),s.jsx(K,{className:"absolute right-0 -top-2 w-6 h-6 border border-gray-500 rounded-full bg-gray-400 bg-opacity-55",onClick:()=>v(a)})]},a+"/"+t))}),e.attachments&&e.attachments.length>0&&e.attachments.map((t,a)=>s.jsx(U,{className:"pl-6",after:s.jsx(u,{mode:"plain",onClick:()=>v(a),children:"X"}),children:s.jsx(V,{children:t})},a+t)),s.jsx(ce,{multiple:!0,label:"Attach a new file",accept:"image/*",onChange:L})]}),s.jsxs("div",{children:[s.jsxs(l,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Address",s.jsx("span",{className:"text-red-600",children:"*"})]}),s.jsxs("div",{className:"overflow-visible",children:[s.jsx(_,{status:!(e.location&&e.location.available)&&r?"error":"default",geoposition:e.location||{available:!1},setGeoposition:t=>c({...e,location:t})}),s.jsx(l,{className:"pl-8 text-red-400",hidden:!(!((k=e.location)!=null&&k.available)&&r),children:"This field is required"})]})]}),s.jsxs("div",{children:[s.jsx(l,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"On map"}),s.jsx(U,{children:s.jsx($,{available:((C=e.location)==null?void 0:C.available)||!1,type:"target",center:{latitude:Number(((T=(b=e.location)==null?void 0:b.latLong)==null?void 0:T.latitude)||0),longitude:Number(((I=(y=e.location)==null?void 0:y.latLong)==null?void 0:I.longitude)||0)}})})]})]})}),s.jsx("div",{className:"sticky bottom-24",children:s.jsxs("div",{className:"flex flex-row justify-center items-center",children:[s.jsx(u,{className:"bg-green-400 w-full",onClick:B,children:"Create"}),s.jsx(u,{className:"bg-red-400 w-full",onClick:E,children:"Cancel"})]})}),s.jsx(se,{open:R,close:z,controller:{closeOnPullDown:!0,closeOnBackdropClick:!0,closeOnPullUp:!0},index:q,plugins:[te],slides:(S=e.attachments)==null?void 0:S.map(t=>({src:t}))})]})};export{xe as TaskCreate};
