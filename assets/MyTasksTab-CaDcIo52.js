const __vite__fileDeps=["./MapPage-DLNOSf0f.js","./index-C6RQBjW7.js","./index-DtgpMxFK.css","./GeolocationRequest-BOCPMj9i.js","./Input-B2kaQjut.js","./TasksList-DUgTnU94.js","./TaskCard-BJaT2bay.js","./FileInput-CyBnf-oW.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as t,c as N,s as G,b as K,k as H,l as Q,j as e,T as V,C as m,m as W,n as ee,R as J,_ as Z,h as se,d as te,B as ae}from"./index-C6RQBjW7.js";import{S as X,a as F,b as le,M as ne,G as ce,F as oe}from"./GeolocationRequest-BOCPMj9i.js";import{M as q,a as ie,T as re}from"./TaskCard-BJaT2bay.js";import{L as de,I as B,C as P,B as D,S as he}from"./Input-B2kaQjut.js";import{F as me}from"./FileInput-CyBnf-oW.js";function ue({title:r,titleId:f,...p},o){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":f},p),r?t.createElement("title",{id:f},r):null,t.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z",clipRule:"evenodd"}))}const ge=t.forwardRef(ue),xe=({closeModal:r})=>{var c,u;const f=N(G),p=K(),[o,w]=t.useState(!1),[g,b]=t.useState(""),[l,O]=t.useState(""),[x,S]=t.useState(""),[i,k]=t.useState(),[d,M]=t.useState([]),[n,C]=t.useState({available:!1}),j=t.useMemo(()=>f.id,[f]),L=()=>{var a,h;const s=JSON.parse(sessionStorage.getItem("saved-task")||"{}");try{b(s.title),O(s.desc),S(((a=s==null?void 0:s.reward)==null?void 0:a.split(" ")[0])||""),k((h=s==null?void 0:s.reward)==null?void 0:h.split(" ")[1]),M(s.attachments||[]),C(s.location)}catch{console.log("Cant parse saved task")}},T=t.useCallback((s,a,h,U,A,Y,$)=>({id:Date.now().toString(),title:s,desc:a,reward:h+" "+U,attachments:A,location:Y,customer:$,status:"open"}),[]),[y,v]=t.useState(N(H));t.useEffect(()=>{y&&(console.log("Restore created task"),L())},[]),t.useEffect(()=>{g.trim()!==""||l.trim()!==""||x.trim()!==""||(i||"").trim()!==""||d.length>0||n.available?(console.log("Changes made"),v(!0),sessionStorage.setItem("saved-task",JSON.stringify(T(g,l,x,i||"TON",d,n,j)))):(v(!1),sessionStorage.removeItem("saved-task"))},[g,l,x,i,d,n,j,T]),t.useEffect(()=>{console.log("Update changes store"),p(Q(y))},[y,p]);const R=s=>{const a=s.currentTarget.files;if(a&&(a==null?void 0:a.length)>0){const h=[];for(let A=0;A<a.length;A++)h.push(URL.createObjectURL(a[A]));M([...d||[],...h])}},_=s=>{const a=[...d];a.splice(s,1),M(a)},E=()=>{const s=document.getElementsByTagName("input");for(let h=0;h<s.length;h++)s[h].blur();if(g.trim().length===0||l.trim().length===0||x.length===0||(i||"")===""||!n.available)return w(!0);const a=T(g,l,x,i||"TON",d,n,j);p(ee(a)),v(!1),sessionStorage.removeItem("created-task"),r()},I=()=>{v(!1),sessionStorage.removeItem("created-task"),r()};return e.jsxs("div",{children:[e.jsx("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:e.jsx(V,{children:"Task creation"})}),e.jsx("div",{children:e.jsxs(de,{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{children:[e.jsxs(m,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Title",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(B,{value:g,status:g.length===0&&o?"error":"default",placeholder:"Title...",onChange:s=>{const a=s.currentTarget.value;b(a)}}),e.jsx(m,{className:"pl-8 text-red-400",hidden:!(l.length===0&&o),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(m,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Description",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(B,{placeholder:"Description...",value:l,status:l.length===0&&o?"error":"default",onChange:s=>O(s.currentTarget.value)}),e.jsx(m,{className:"pl-8 text-red-400",hidden:!(l.length===0&&o),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(m,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Reward",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"flex items-center justify-stretch h-fit",children:[e.jsxs("div",{className:"w-2/5 h-full flex flex-col justify-between",children:[e.jsx(B,{placeholder:"Cost...",inputMode:"numeric",type:"number",status:x.length===0&&o?"error":"default",value:x||"",onChange:s=>{S(s.currentTarget.value)}}),e.jsx(m,{className:"pl-8 text-red-400",hidden:!(l.length===0&&o),children:"This field is required"})]}),e.jsxs("div",{className:"w-3/5 flex flex-col h-full justify-between",children:[e.jsxs(X,{className:"h-12 items-center",children:[e.jsx(F,{onClick:()=>k("TON"),selected:i==="TON",children:"TON"}),e.jsx(F,{onClick:()=>k("USDT"),selected:i==="USDT",children:"USDT"}),e.jsx(F,{onClick:()=>k("BTC"),selected:i==="BTC",children:"BTC"})]}),e.jsx(m,{className:"pl-8 text-red-400",hidden:!(l.length===0&&o),children:"Please select currency"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Attachments"}),d&&d.length>0&&d.map((s,a)=>e.jsx(P,{className:"pl-6",after:e.jsx(D,{mode:"plain",onClick:()=>_(a),children:"X"}),children:e.jsx(W,{children:s})},a+s)),e.jsx(me,{multiple:!0,label:"Attach a new file",accept:"image/*",onChange:R})]}),e.jsxs("div",{children:[e.jsxs(m,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Address",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"overflow-visible",children:[e.jsx(le,{status:!n.available&&o?"error":"default",geoposition:n||{available:!1},setGeoposition:s=>C(s)}),e.jsx(m,{className:"pl-8 text-red-400",hidden:!(l.length===0&&o),children:"This field is required"})]})]}),n.available&&e.jsxs("div",{children:[e.jsx(m,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"On map"}),e.jsx(P,{children:e.jsx(ne,{type:"target",center:{latitude:Number((c=n.latLong)==null?void 0:c.latitude),longitude:Number((u=n.latLong)==null?void 0:u.longitude)}})})]})]})}),e.jsx("div",{className:"sticky bottom-1 pt-8",children:e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx(D,{className:"bg-green-400 w-full",onClick:E,children:"Create"}),e.jsx(D,{className:"bg-red-400 w-full",onClick:I,children:"Cancel"})]})})]})},pe=J.lazy(()=>Z(()=>import("./MapPage-DLNOSf0f.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(({MapPage:r})=>({default:r}))),z=J.lazy(()=>Z(()=>import("./TasksList-DUgTnU94.js"),__vite__mapDeps([5,1,2,4,6,3,7]),import.meta.url).then(({TasksList:r})=>({default:r}))),Ne=()=>{const[r,f]=t.useState("list"),p=c=>{console.log("Changing mode"),f(c)},[o,w]=t.useState(!1),g=()=>{w(!0),console.log("Modal opened")},b=()=>{w(!1),console.log("Modal closed")},[l,O]=t.useState(),x=c=>{console.log("Selected task: "+c),O([...j,...T].find(u=>u.id===c)),g()},[S,i]=t.useState(!1),k=N(H),d=()=>{i(!0),console.log("Modal opened")},M=()=>{i(!1),console.log("Modal closed")},n=N(G),C=N(se),[j,L]=t.useState([]),[T,y]=t.useState([]),v=t.useCallback(c=>{const u=c.filter(s=>s.customer===n.id&&(s.status==="open"||s.status==="active"));return console.log("Function - getActiveTasks: Active tasks length = "+u.length),u},[n]),R=t.useCallback(c=>{const u=c.filter(s=>s.acceptedBy===n.id&&s.status==="closed");return console.log("Function - getFinishedTasks: Finished tasks length = "+u.length),u},[n]),[_,E]=t.useState(!0);t.useEffect(()=>{console.log("MyTasksTab: Tasks array changed"),L(v(C)),y(R(C)),console.log("Force redo accordeon"),E(!1),setTimeout(()=>{E(!0)},50)},[C,v,R]);const I=N(te);return I.available?e.jsxs("div",{className:"md:container md:mx-auto",children:[e.jsx(he,{className:"pt-4 h-full",header:e.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[e.jsx(V,{className:"self-start",children:"Tasks"}),e.jsxs(X,{className:"w-40 h-8 self-end ",children:[e.jsx(F,{className:"w-4 h-8 align-middle p-1",onClick:()=>{p("list")},children:"List"}),e.jsx(F,{className:"w-4 h-8 align-middle p-1",onClick:()=>{p("map")},children:"Map"})]})]}),children:r==="list"?e.jsxs(e.Fragment,{children:[e.jsx(P,{before:e.jsxs("div",{children:[e.jsx(ge,{className:"h-8 w-8"}),k&&e.jsx(ae,{className:"absolute top-1 right-1 bg-yellow-600",type:"number",children:"!"})]}),onClick:d,children:"Create a new task"}),e.jsx(z,{title:"Active tasks",tasks:j,mode:"edit",open:_}),e.jsx(z,{title:"Finished tasks",tasks:T,mode:"view"})]}):e.jsx(e.Fragment,{children:e.jsx(pe,{tasks:j,position:I,onBubbleClick:x})})}),e.jsx(q,{open:o,onOpenChange:c=>{w(c)},className:"z-10 h-2/3",header:e.jsx(ie,{after:e.jsx(oe,{className:"text-[--tg-theme-plain-foreground] h-4",onClick:b})}),children:e.jsx(re,{taskId:l==null?void 0:l.id,closeModal:b,mode:"view"})}),e.jsx(q,{open:S,onOpenChange:c=>{i(c)},className:"z-10 top-0 bottom-0",children:e.jsx(xe,{openModal:S,closeModal:M})})]}):e.jsx(ce,{})};export{Ne as MyTasksTab};
