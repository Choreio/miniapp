const __vite__fileDeps=["./MapContainer-gtSyn9BI.js","./index-BEoJHiBI.js","./index-DWPYAgq-.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as j,t as M,_ as O,z as R,j as t,P as I}from"./index-BEoJHiBI.js";var b={};Object.defineProperty(b,"__esModule",{value:!0});var G=b.useGeolocated=void 0;const n=j;function L(c={}){const{positionOptions:e={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:h=!0,userDecisionTimeout:l=void 0,suppressLocationOnMount:m=!1,watchPosition:u=!1,geolocationProvider:s=typeof navigator<"u"?navigator.geolocation:void 0,watchLocationPermissionChange:g=!1,onError:a,onSuccess:r}=c,i=(0,n.useRef)(0),w=(0,n.useRef)(!0),f=(0,n.useRef)(0),[S,P]=(0,n.useState)(h),[k,y]=(0,n.useState)(),[_,A]=(0,n.useState)(),[T,E]=(0,n.useState)(),[N,D]=(0,n.useState)(),d=(0,n.useCallback)(()=>{i.current&&window.clearTimeout(i.current)},[]),p=(0,n.useCallback)(o=>{d(),w.current&&(y(()=>{}),P(!1),E(o)),a==null||a(o)},[a,d]),x=(0,n.useCallback)(o=>{d(),w.current&&(y(o.coords),A(o.timestamp),P(!0),E(()=>{})),r==null||r(o)},[r,d]),C=(0,n.useCallback)(()=>{if(!s||!s.getCurrentPosition||!s.watchPosition)throw new Error("The provided geolocation provider is invalid");l&&(i.current=window.setTimeout(()=>{p()},l)),u?f.current=s.watchPosition(x,p,e):s.getCurrentPosition(x,p,e)},[s,u,l,p,x,e]);return(0,n.useEffect)(()=>{let o;return g&&s&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(v=>{o=v,o.onchange=()=>{D(o.state)}}).catch(v=>{console.error("Error updating the permissions",v)}),()=>{o&&(o.onchange=null)}},[]),(0,n.useEffect)(()=>(m||C(),()=>{d(),u&&f.current&&(s==null||s.clearWatch(f.current))}),[N]),{getPosition:C,coords:k,timestamp:_,isGeolocationEnabled:S,isGeolocationAvailable:!!s,positionError:T}}G=b.useGeolocated=L;const z=M.lazy(()=>O(()=>import("./MapContainer-gtSyn9BI.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(({MapContainer:c})=>({default:c})));function q(){const c=R(),{coords:e,isGeolocationAvailable:h,isGeolocationEnabled:l,positionError:m}=G({positionOptions:{enableHighAccuracy:!0},userDecisionTimeout:1/0,watchPosition:!0,watchLocationPermissionChange:!0}),u=[500,1e3,2e3,3e3,5e3],[s,g]=j.useState(500),a=i=>{i.preventDefault(),g(Number(i.target.value))};function r(){navigator.permissions.query({name:"geolocation"}).then(function(i){(i.state=="granted"||i.state=="prompt"||i.state=="denied")&&console.log(i.state),i.onchange=function(){console.log(i.state)}})}return c?t.jsxs("div",{className:"md:container md:mx-auto text-center",children:[t.jsx("div",{className:"text-4xl pt-4",children:"Tasks around you"}),t.jsxs("div",{className:"text-slate-400",children:["You are looking for tasks in"," ",t.jsx("select",{onChange:a,children:u.map(i=>t.jsx("option",{value:i,children:i},i))})," ","meters from you"]}),h?l?m?t.jsx("div",{children:"positionError"}):t.jsxs("div",{className:"flex-col hidden",children:[t.jsx("span",{children:"Geolocation is available"}),t.jsxs("span",{children:["Accuracy: ",e==null?void 0:e.accuracy]}),t.jsxs("span",{children:["Altitude: ",e==null?void 0:e.altitude]}),t.jsxs("span",{children:["Altitude accuracy: ",e==null?void 0:e.altitudeAccuracy]}),t.jsxs("span",{children:["Heading: ",e==null?void 0:e.heading]}),t.jsxs("span",{children:["Latitude: ",e==null?void 0:e.latitude]}),t.jsxs("span",{children:["Longitude: ",e==null?void 0:e.longitude]}),t.jsxs("span",{children:["Speed: ",e==null?void 0:e.speed]})]}):t.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[t.jsx("span",{children:"Geolocation not enabled"}),t.jsx("button",{className:"w-32 bg-slate-600 rounded-lg p-1 text-center select-none cursor-pointer hover:bg-slate-700",onClick:r,children:"Grant permission"})]}):t.jsx("div",{children:"Your browser doesnt support geolocation"}),e&&t.jsx(j.Suspense,{fallback:t.jsx("div",{className:"w-full h-[--tg-viewport-width] bg-slate-300 rounded-full"}),children:t.jsx(z,{latitude:e.latitude,longitude:e.longitude,radius:s})})]}):t.jsx(I,{header:"Oops",description:"Application was launched with missing init data",children:t.jsx("img",{alt:"Telegram sticker",src:"https://xelene.me/telegram.gif",style:{display:"block",width:"144px",height:"144px"}})})}export{q as MapPage};
