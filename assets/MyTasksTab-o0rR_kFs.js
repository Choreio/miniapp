const __vite__fileDeps=["./GeolocationRequest-BFNnbTdg.js","./index-CCnSMLCa.js","./index-DFbujpgL.css","./Input-CH71GcSL.js","./MapPage-DKSdopKp.js","./TaskCard-DzhCk9sN.js","./ModalHeader-Dit18kRc.js","./Avatar-Q7kAwF_c.js","./FileInput-MbJxmDZT.js","./TasksList-DWxmQp0m.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as s,R as _,_ as O,c as v,s as P,b as $,k as U,l as K,j as e,T as q,C as u,m as Q,n as W,h as ee,d as te,B as se}from"./index-CCnSMLCa.js";import{b as ae,G as le,S as ne,a as D,F as oe}from"./GeolocationRequest-BFNnbTdg.js";import{I as ie,a as A,M as re}from"./ModalHeader-Dit18kRc.js";import{L as ce,I,C as R,B as E,S as de}from"./Input-CH71GcSL.js";import{F as he}from"./FileInput-MbJxmDZT.js";function me({title:n,titleId:g,...p},l){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":g},p),n?s.createElement("title",{id:g},n):null,s.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z",clipRule:"evenodd"}))}const ue=s.forwardRef(me),xe=_.lazy(()=>O(()=>import("./GeolocationRequest-BFNnbTdg.js").then(n=>n.M),__vite__mapDeps([0,1,2,3]),import.meta.url).then(({MapContainerYandex:n})=>({default:n}))),pe=({closeModal:n})=>{var F,L;const g=v(P),p=$(),[l,w]=s.useState(!1),[x,C]=s.useState(""),[c,b]=s.useState(""),[d,f]=s.useState(""),[o,j]=s.useState(),[h,N]=s.useState([]),[r,T]=s.useState({available:!1}),i=s.useMemo(()=>g.id,[g]),H=()=>{var a,m;const t=JSON.parse(sessionStorage.getItem("saved-task")||"{}");try{C(t.title),b(t.desc),f(((a=t==null?void 0:t.reward)==null?void 0:a.split(" ")[0])||""),j((m=t==null?void 0:t.reward)==null?void 0:m.split(" ")[1]),N(t.attachments||[]),T(t.location)}catch{console.log("Cant parse saved task")}},y=s.useCallback((t,a,m,B,k,Z,X)=>({id:Date.now().toString(),title:t,desc:a,reward:m+" "+B,attachments:k,location:Z,customer:X,status:"open"}),[]),[S,M]=s.useState(v(U));s.useEffect(()=>{S&&(console.log("Restore created task"),H())},[S]),s.useEffect(()=>{x.trim()!==""||c.trim()!==""||d.trim()!==""||(o||"").trim()!==""||h.length>0||r.available?(console.log("Changes made"),M(!0),sessionStorage.setItem("saved-task",JSON.stringify(y(x,c,d,o||"TON",h,r,i)))):(M(!1),sessionStorage.removeItem("saved-task"))},[x,c,d,o,h,r,i,y]),s.useEffect(()=>{console.log("Update changes store"),p(K(S))},[S,p]);const V=t=>{const a=t.currentTarget.files;if(a&&(a==null?void 0:a.length)>0){const m=[];for(let k=0;k<a.length;k++)m.push(URL.createObjectURL(a[k]));N([...h||[],...m])}},G=t=>{const a=[...h];a.splice(t,1),N(a)},J=()=>{const t=document.getElementsByTagName("input");for(let m=0;m<t.length;m++)t[m].blur();if(x.trim().length===0||c.trim().length===0||d.length===0||(o||"")===""||!r.available)return w(!0);const a=y(x,c,d,o||"TON",h,r,i);p(W(a)),M(!1),sessionStorage.removeItem("created-task"),n()},Y=()=>{M(!1),sessionStorage.removeItem("saved-task"),n()};return e.jsxs("div",{children:[e.jsx("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:e.jsx(q,{children:"Task creation"})}),e.jsx("div",{children:e.jsxs(ce,{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{children:[e.jsxs(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Title",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(I,{value:x,status:x.length===0&&l?"error":"default",placeholder:"Title...",onChange:t=>{const a=t.currentTarget.value;C(a)}}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!(c.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Description",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(I,{placeholder:"Description...",value:c,status:c.length===0&&l?"error":"default",onChange:t=>b(t.currentTarget.value)}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!(c.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Reward",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"flex items-center justify-stretch h-fit",children:[e.jsxs("div",{className:"w-2/5 h-full flex flex-col justify-between",children:[e.jsx(I,{placeholder:"Cost...",inputMode:"numeric",type:"number",status:d.length===0&&l?"error":"default",value:d||"",onChange:t=>{f(t.currentTarget.value)}}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!(d.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{className:"w-3/5 flex flex-col h-full justify-between",children:[e.jsxs(ie,{className:"h-12 items-center",children:[e.jsx(A,{onClick:()=>j("TON"),mode:o==="TON"?"bezeled":"plain",children:"TON"}),e.jsx(A,{onClick:()=>j("USDT"),mode:o==="USDT"?"bezeled":"plain",children:"USDT"}),e.jsx(A,{onClick:()=>j("BTC"),mode:o==="BTC"?"bezeled":"plain",children:"BTC"})]}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!((o||"")===""&&l),children:"Please select currency"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Attachments"}),h&&h.length>0&&h.map((t,a)=>e.jsx(R,{className:"pl-6",after:e.jsx(E,{mode:"plain",onClick:()=>G(a),children:"X"}),children:e.jsx(Q,{children:t})},a+t)),e.jsx(he,{multiple:!0,label:"Attach a new file",accept:"image/*",onChange:V})]}),e.jsxs("div",{children:[e.jsxs(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Address",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"overflow-visible",children:[e.jsx(ae,{status:!r.available&&l?"error":"default",geoposition:r||{available:!1},setGeoposition:t=>T(t)}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!(c.length===0&&l),children:"This field is required"})]})]}),r.available&&e.jsxs("div",{children:[e.jsx(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"On map"}),e.jsx(R,{children:e.jsx(xe,{type:"target",center:{latitude:Number((F=r.latLong)==null?void 0:F.latitude),longitude:Number((L=r.latLong)==null?void 0:L.longitude)}})})]})]})}),e.jsx("div",{className:"sticky bottom-0 pt-8",children:e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx(E,{className:"bg-green-400 w-full",onClick:J,children:"Create"}),e.jsx(E,{className:"bg-red-400 w-full",onClick:Y,children:"Cancel"})]})})]})},ge=_.lazy(()=>O(()=>import("./MapPage-DKSdopKp.js"),__vite__mapDeps([4,1,2,0,3,5,6,7,8]),import.meta.url).then(({MapPage:n})=>({default:n}))),z=_.lazy(()=>O(()=>import("./TasksList-DWxmQp0m.js"),__vite__mapDeps([9,1,2,3,5,6,0,7,8]),import.meta.url).then(({TasksList:n})=>({default:n}))),ke=()=>{const[n,g]=s.useState("list"),p=i=>{console.log("Changing mode"),g(i)},[l,w]=s.useState(!1),[x,C]=s.useState(!1),c=v(U),b=()=>{w(!0),console.log("Modal opened")},d=()=>{C(!0)},f=v(P),o=v(ee),j=s.useMemo(()=>o.filter(i=>i.customer===f.id&&i.status!=="closed"),[o,f]),h=s.useMemo(()=>o.filter(i=>i.customer===f.id&&i.status==="closed"),[o,f]),[N,r]=s.useState(!0);s.useEffect(()=>{console.log("Force redo accordeon"),r(!1),setTimeout(()=>{r(!0)},50)},[o]);const T=v(te);return T.available?e.jsxs("div",{className:"md:container md:mx-auto",children:[e.jsx(de,{className:"pt-4 h-full",header:e.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[e.jsx(q,{className:"self-start",children:"Tasks"}),e.jsxs(ne,{className:"w-40 h-8 self-end ",children:[e.jsx(D,{className:"w-4 h-8 align-middle p-1",onClick:()=>{p("list")},children:"List"}),e.jsx(D,{className:"w-4 h-8 align-middle p-1",onClick:()=>{p("map")},children:"Map"})]})]}),children:n==="list"?e.jsxs(e.Fragment,{children:[e.jsx(R,{disabled:l,before:e.jsxs("div",{children:[c&&e.jsx(se,{className:"absolute z-50 top-1 left-1 bg-yellow-600",type:"number",children:"!"}),e.jsx(ue,{className:"h-8 w-8"})]}),onClick:()=>{l||b()},children:"Create a new task"}),e.jsx(z,{title:"Active tasks",tasks:j,mode:"edit",open:N}),e.jsx(z,{title:"Finished tasks",tasks:h,mode:"view"})]}):e.jsx(e.Fragment,{children:e.jsx(ge,{parent:"MyTasks",tasks:j,position:T})})}),l&&e.jsxs("div",{id:"pseudoModal",hidden:!l,className:"fixed top-[15%] bottom-0 bg-[--tg-theme-bg-color] overflow-y-scroll".concat(" ",x?"animate-bottomDisappear":"animate-bottomAppear"," ",l?"z-10":"-z-10"),style:{animationFillMode:"forward"},onAnimationEnd:()=>{if(x){const i=document.getElementById("pseudoModal");i&&(i.style.opacity="0"),w(!1),C(!1),console.log("Modal closed")}},children:[e.jsx("div",{className:"sticky -top-0 inset-0 z-[11] bg-[--tg-theme-bg-color]",children:e.jsx(re,{after:e.jsx(oe,{className:"text-[--tg-theme-plain-foreground] h-4",onClick:d})})}),e.jsx(pe,{openModal:l,closeModal:d})]})]}):e.jsx(le,{})};export{ke as MyTasksTab};
