const __vite__fileDeps=["./MapPage-DTYdOAZb.js","./index-XFCmIY7W.js","./index-7EkclafM.css","./GeolocationRequest-Bh0W5rBv.js","./Input-CD72tTlX.js","./TaskCard-Lcs76SiA.js","./ModalHeader-Pwm9k7vM.js","./Avatar-BuXBSrWv.js","./FileInput-CkRkkgzE.js","./TasksList-D2yTsLkw.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as t,c as v,s as D,b as $,k as z,l as K,j as e,T as P,C as u,m as Q,n as W,R as U,_ as q,h as ee,d as se,B as te}from"./index-XFCmIY7W.js";import{b as ae,M as le,G as ne,S as re,a as _,F as ie}from"./GeolocationRequest-Bh0W5rBv.js";import{I as oe,a as A,M as ce}from"./ModalHeader-Pwm9k7vM.js";import{L as de,I,C as E,B as R,S as he}from"./Input-CD72tTlX.js";import{F as me}from"./FileInput-CkRkkgzE.js";function ue({title:o,titleId:g,...p},l){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":g},p),o?t.createElement("title",{id:g},o):null,t.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z",clipRule:"evenodd"}))}const xe=t.forwardRef(ue),pe=({closeModal:o})=>{var O,F;const g=v(D),p=$(),[l,w]=t.useState(!1),[x,C]=t.useState(""),[i,b]=t.useState(""),[c,f]=t.useState(""),[n,j]=t.useState(),[d,N]=t.useState([]),[r,T]=t.useState({available:!1}),h=t.useMemo(()=>g.id,[g]),H=()=>{var a,m;const s=JSON.parse(sessionStorage.getItem("saved-task")||"{}");try{C(s.title),b(s.desc),f(((a=s==null?void 0:s.reward)==null?void 0:a.split(" ")[0])||""),j((m=s==null?void 0:s.reward)==null?void 0:m.split(" ")[1]),N(s.attachments||[]),T(s.location)}catch{console.log("Cant parse saved task")}},y=t.useCallback((s,a,m,L,k,X,Y)=>({id:Date.now().toString(),title:s,desc:a,reward:m+" "+L,attachments:k,location:X,customer:Y,status:"open"}),[]),[S,M]=t.useState(v(z));t.useEffect(()=>{S&&(console.log("Restore created task"),H())},[S]),t.useEffect(()=>{x.trim()!==""||i.trim()!==""||c.trim()!==""||(n||"").trim()!==""||d.length>0||r.available?(console.log("Changes made"),M(!0),sessionStorage.setItem("saved-task",JSON.stringify(y(x,i,c,n||"TON",d,r,h)))):(M(!1),sessionStorage.removeItem("saved-task"))},[x,i,c,n,d,r,h,y]),t.useEffect(()=>{console.log("Update changes store"),p(K(S))},[S,p]);const G=s=>{const a=s.currentTarget.files;if(a&&(a==null?void 0:a.length)>0){const m=[];for(let k=0;k<a.length;k++)m.push(URL.createObjectURL(a[k]));N([...d||[],...m])}},V=s=>{const a=[...d];a.splice(s,1),N(a)},J=()=>{const s=document.getElementsByTagName("input");for(let m=0;m<s.length;m++)s[m].blur();if(x.trim().length===0||i.trim().length===0||c.length===0||(n||"")===""||!r.available)return w(!0);const a=y(x,i,c,n||"TON",d,r,h);p(W(a)),M(!1),sessionStorage.removeItem("created-task"),o()},Z=()=>{M(!1),sessionStorage.removeItem("saved-task"),o()};return e.jsxs("div",{children:[e.jsx("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:e.jsx(P,{children:"Task creation"})}),e.jsx("div",{children:e.jsxs(de,{className:"flex flex-col gap-2 h-full",children:[e.jsxs("div",{children:[e.jsxs(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Title",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(I,{value:x,status:x.length===0&&l?"error":"default",placeholder:"Title...",onChange:s=>{const a=s.currentTarget.value;C(a)}}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!(i.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Description",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(I,{placeholder:"Description...",value:i,status:i.length===0&&l?"error":"default",onChange:s=>b(s.currentTarget.value)}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!(i.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Reward",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"flex items-center justify-stretch h-fit",children:[e.jsxs("div",{className:"w-2/5 h-full flex flex-col justify-between",children:[e.jsx(I,{placeholder:"Cost...",inputMode:"numeric",type:"number",status:c.length===0&&l?"error":"default",value:c||"",onChange:s=>{f(s.currentTarget.value)}}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!(c.length===0&&l),children:"This field is required"})]}),e.jsxs("div",{className:"w-3/5 flex flex-col h-full justify-between",children:[e.jsxs(oe,{className:"h-12 items-center",children:[e.jsx(A,{onClick:()=>j("TON"),mode:n==="TON"?"bezeled":"plain",children:"TON"}),e.jsx(A,{onClick:()=>j("USDT"),mode:n==="USDT"?"bezeled":"plain",children:"USDT"}),e.jsx(A,{onClick:()=>j("BTC"),mode:n==="BTC"?"bezeled":"plain",children:"BTC"})]}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!((n||"")===""&&l),children:"Please select currency"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Attachments"}),d&&d.length>0&&d.map((s,a)=>e.jsx(E,{className:"pl-6",after:e.jsx(R,{mode:"plain",onClick:()=>V(a),children:"X"}),children:e.jsx(Q,{children:s})},a+s)),e.jsx(me,{multiple:!0,label:"Attach a new file",accept:"image/*",onChange:G})]}),e.jsxs("div",{children:[e.jsxs(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Address",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"overflow-visible",children:[e.jsx(ae,{status:!r.available&&l?"error":"default",geoposition:r||{available:!1},setGeoposition:s=>T(s)}),e.jsx(u,{className:"pl-8 text-red-400",hidden:!(i.length===0&&l),children:"This field is required"})]})]}),r.available&&e.jsxs("div",{children:[e.jsx(u,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"On map"}),e.jsx(E,{children:e.jsx(le,{type:"target",center:{latitude:Number((O=r.latLong)==null?void 0:O.latitude),longitude:Number((F=r.latLong)==null?void 0:F.longitude)}})})]})]})}),e.jsx("div",{className:"sticky bottom-0 pt-8",children:e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx(R,{className:"bg-green-400 w-full",onClick:J,children:"Create"}),e.jsx(R,{className:"bg-red-400 w-full",onClick:Z,children:"Cancel"})]})})]})},ge=U.lazy(()=>q(()=>import("./MapPage-DTYdOAZb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url).then(({MapPage:o})=>({default:o}))),B=U.lazy(()=>q(()=>import("./TasksList-D2yTsLkw.js"),__vite__mapDeps([9,1,2,4,5,6,3,7,8]),import.meta.url).then(({TasksList:o})=>({default:o}))),ke=()=>{const[o,g]=t.useState("list"),p=h=>{console.log("Changing mode"),g(h)},[l,w]=t.useState(!1),[x,C]=t.useState(!1),i=v(z),b=()=>{w(!0),console.log("Modal opened")},c=()=>{C(!0)},f=v(D),n=v(ee),j=t.useMemo(()=>n.filter(h=>h.customer===f.id&&h.status!=="closed"),[n,f]),d=t.useMemo(()=>n.filter(h=>h.customer===f.id&&h.status==="closed"),[n,f]),[N,r]=t.useState(!0);t.useEffect(()=>{console.log("Force redo accordeon"),r(!1),setTimeout(()=>{r(!0)},50)},[n]);const T=v(se);return T.available?e.jsxs("div",{className:"md:container md:mx-auto",children:[e.jsx(he,{className:"pt-4 h-full",header:e.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[e.jsx(P,{className:"self-start",children:"Tasks"}),e.jsxs(re,{className:"w-40 h-8 self-end ",children:[e.jsx(_,{className:"w-4 h-8 align-middle p-1",onClick:()=>{p("list")},children:"List"}),e.jsx(_,{className:"w-4 h-8 align-middle p-1",onClick:()=>{p("map")},children:"Map"})]})]}),children:o==="list"?e.jsxs(e.Fragment,{children:[e.jsx(E,{disabled:l,before:e.jsxs("div",{children:[i&&e.jsx(te,{className:"absolute z-50 top-1 left-1 bg-yellow-600",type:"number",children:"!"}),e.jsx(xe,{className:"h-8 w-8"})]}),onClick:()=>{l||b()},children:"Create a new task"}),e.jsx(B,{title:"Active tasks",tasks:j,mode:"edit",open:N}),e.jsx(B,{title:"Finished tasks",tasks:d,mode:"view"})]}):e.jsx(e.Fragment,{children:e.jsx(ge,{parent:"MyTasks",tasks:j,position:T})})}),e.jsxs("div",{hidden:!l,className:"fixed top-[30%] bottom-0 bg-[--tg-theme-bg-color] overflow-scroll".concat(" ",x?"animate-bottomDisappear":"animate-bottomAppear"," ",l?"z-10":"-z-10"),onAnimationEnd:()=>{x&&(w(!1),C(!1),console.log("Modal closed"))},children:[e.jsx(ce,{after:e.jsx(ie,{className:"text-[--tg-theme-plain-foreground] h-4",onClick:c})}),e.jsx(pe,{openModal:l,closeModal:c})]})]}):e.jsx(ne,{})};export{ke as MyTasksTab};
