import{r as m,_ as j,b as C,j as e,T as M,c as w,h as g,d as f,e as x,S as _,f as T,C as D,J as L,P as O,i as J,t as z,k as y,s as F,l as H,m as q,E as K,n as V,o as W,p as Y,B as Z,q as $}from"./index-BMH8RaQp.js";import{_ as A,a as I,S as G,B as P,C as R}from"./Section-FUz0Z9d-.js";import{c as k,A as Q}from"./Avatar-BJxoOFhw.js";const X=m.forwardRef((t,l)=>{var{mode:d="default",before:r,after:n,className:c,children:o,Component:i}=t,p=j(t,["mode","before","after","className","children","Component"]);const s=C(),u=s==="ios"?_:T;return e.jsxs(M,w(f({ref:l,Component:i||"button",className:x("tgui-a8ce18a8594cea9b",d==="destructive"&&"tgui-6e7ca796043fe6ca",s==="ios"&&"tgui-f464dba82cb8b46e",c)},p),{children:[g(r)&&r,g(o)&&e.jsx(u,{children:o}),g(n)&&n]}))}),ee=m.forwardRef((t,l)=>{var{Component:d="span",className:r}=t,n=j(t,["Component","className"]);return e.jsx(d,w(f({},n),{ref:l,className:x("tgui-b9fd8cdf929947df",r)}))}),ae=t=>{var l=A({},I(t));return C()==="ios"?e.jsx(D,f({caps:!0},l)):e.jsx(_,f({level:"2",weight:"2"},l))},se={base:"tgui-8ca550c2fc85eff5",ios:"tgui-7707c5d942b7b9af"},te={default:"tgui-7584398855f80ae6",error:"tgui-41b168516bddcf4b",focused:"tgui-89277928456f0e30"},le=m.forwardRef((t,l)=>{var{status:d,header:r,before:n,after:c,disabled:o,children:i,className:p,onFocus:s,onBlur:u}=t,N=j(t,["status","header","before","after","disabled","children","className","onFocus","onBlur"]);const b=C(),[E,v]=m.useState(!1),S=d||(E?"focused":"default"),U=k(s,()=>{o||v(!0)}),a=k(u,()=>v(!1));return e.jsxs("div",{ref:l,className:x("tgui-92da7016c7125c02",se[b],te[S],o&&"tgui-4a83fef1f04acb0e"),"aria-disabled":o,children:[e.jsxs("label",w(f({"aria-disabled":o,className:x("tgui-0f5050defacbf813",p),onFocus:U,onBlur:a},N),{children:[g(n)&&e.jsx("div",{className:"tgui-8f04eff653cfa5e5",children:n}),i,g(c)&&e.jsx("div",{className:"tgui-16b3783d394bc7db",children:c})]})),g(r)&&b==="base"&&e.jsx(ae,{className:"tgui-9f9a52f695b85cc9",children:r})]})}),re=t=>{var l=A({},I(t));return e.jsx("svg",w(f({width:"28",height:"28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l),{children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.286 6.445c-2.342-2.307-6.19-2.307-8.53 0l-5.353 5.272a.99.99 0 0 1-1.388-1.41l5.352-5.272c3.112-3.065 8.196-3.065 11.307 0a7.598 7.598 0 0 1 0 10.885l-7.347 7.238c-2.355 2.32-6.198 2.32-8.553 0a5.762 5.762 0 0 1 0-8.253l7.381-7.27c1.585-1.56 4.141-1.632 5.814-.167a4.06 4.06 0 0 1 .082 6.068l-6.158 5.688a.99.99 0 0 1-1.343-1.454l6.16-5.687c.93-.859.91-2.29-.044-3.127a2.315 2.315 0 0 0-3.122.088l-7.381 7.27a3.784 3.784 0 0 0 0 5.435c1.584 1.56 4.191 1.56 5.775 0l7.348-7.238a5.62 5.62 0 0 0 0-8.066Z",fill:"currentColor"})}))},ne=m.forwardRef((t,l)=>{var{label:d="Attach file",className:r,children:n}=t,c=j(t,["label","className","children"]);return e.jsxs("div",{ref:l,className:r,children:[n,e.jsxs(X,{Component:"label",before:e.jsx(re,{}),children:[e.jsx(ee,{children:e.jsx("input",f({type:"file",placeholder:d},c))}),d]})]})}),ce=t=>{var{type:l="text",header:d,before:r,after:n,status:c,className:o,disabled:i}=t,p=j(t,["type","header","before","after","status","className","disabled"]);const s=C(),u=s==="ios"?T:_;return e.jsx(le,{header:d,before:r,after:n,status:c,disabled:i,className:x("tgui-d9de1f32aee12a15",s==="ios"&&"tgui-9b2ad13855aef059",o),children:e.jsx(u,f({Component:"input",className:"tgui-c4863cd4c893a047",type:l,disabled:i},p))})},oe=""+new URL("avatar_placeholder_black-DRyce69K.png",import.meta.url).href,ie=""+new URL("avatar_placeholder_white-CbxutB7M.png",import.meta.url).href,B=[{name:"photoUrl",displayName:"Avatar",editable:!0},{name:"id",displayName:"ID",editable:!1},{name:"tg_id",displayName:"Telegram ID",editable:!1},{name:"username",displayName:"Username",editable:!0},{name:"email",displayName:"Email",editable:!0},{name:"fullName",displayName:"Full name",editable:!0},{name:"languageCode",displayName:"Locale",editable:!1},{name:"role",displayName:"Role",editable:!1}],fe=()=>{if(!L())return e.jsx(O,{header:"Oops",description:"Application was launched with missing init data",children:e.jsx("img",{alt:"Telegram sticker",src:"https://xelene.me/telegram.gif",style:{display:"block",width:"144px",height:"144px"}})});const l=J(),d=z(),[r,n]=m.useState(y(F)),[c,o]=m.useState(y(F)),i=y(H),p=y(q),[s,u]=m.useState(c?p:i),[N,b]=m.useState([]);if(!s)return e.jsx(K,{children:"Something went wrong with user"});m.useEffect(()=>{l(V(c))},[c]),m.useEffect(()=>{JSON.stringify(i)!==JSON.stringify(s)?(l(W(s)),b(B.map(a=>s[a.name]!==i[a.name]?a.name:"")),o(!0)):(o(!1),b([]))},[s]),m.useEffect(()=>{c||(console.log("Sync user"),console.log(i),u(i))},[i]);const E=a=>{a.preventDefault(),console.log("Edit mode handler"),n(!0),r&&!c&&n(!1)},v=a=>{a.preventDefault(),console.log("Avatar change");const h=a.currentTarget.files;h&&u({...s,photoUrl:URL.createObjectURL(h[0])})},S=a=>{a.preventDefault(),console.log("Changes saved"),l($(s)),n(!1),o(!1)},U=a=>{a.preventDefault(),console.log("Changes canceled"),u(i),n(!1),o(!1)};return e.jsxs("div",{className:"md:container md:mx-auto pt-2",children:[c&&e.jsx("div",{className:"bg-yellow-400 text-center rounded-lg mb-1",children:"You have uncommited changes!!!"}),e.jsx(G,{className:"flex flex-col h-full gap-2",header:e.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[e.jsx(Y,{className:"self-start",children:"My profile"}),e.jsx(P,{mode:"plain",onClick:E,children:"Edit"})]}),footer:r&&e.jsx("div",{className:"sticky bottom-1",children:e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx(P,{className:"bg-green-400 w-full",onClick:S,children:"Confirm"}),e.jsx(P,{className:"bg-red-400 w-full",onClick:U,children:"Cancel"})]})}),children:e.jsx("div",{children:B.map(a=>e.jsxs("div",{children:[e.jsx(D,{level:"1",weight:"2",className:"p-6 text-[--tg-theme-hint-color]",children:a.displayName}),a.name==="photoUrl"&&e.jsxs(R,{after:a.editable&&r&&e.jsx(ne,{id:"input_file",onChange:v,accept:"image/png, image/jpeg"}),children:[N.includes(a.name)&&e.jsx(Z,{type:"number",mode:"critical",large:!0,className:"absolute left-2 top-2 z-10",children:"Edited"}),e.jsx(Q,{size:96,src:s.photoUrl?s.photoUrl:d.isDark?ie:oe})]}),a.name!=="photoUrl"&&e.jsx(e.Fragment,{children:r&&a.editable?e.jsx(ce,{readOnly:!(r&&a.editable),status:N.includes(a.name)?"error":"default",inputMode:"text",placeholder:a.displayName,value:s[a.name],onChange:h=>{switch(a.name){case"username":u({...s,username:h.currentTarget.value});break;case"email":u({...s,email:h.currentTarget.value});break;case"fullName":u({...s,fullName:h.currentTarget.value});break}}}):e.jsx(R,{children:s[a.name]})})]},a.name))})})]})};export{fe as Profile};
