import{J as A,j as a,P as F,b as O,t as P,r as t,c as g,i as C,s as T,d as B,E as R,e as J,T as _,C as f,B as M,f as G}from"./index-Cl3p8HsZ.js";import{B as N,L as z,S as x,C as m,I as H}from"./Input-O8Z9FtQ7.js";import{F as K,A as W}from"./FileInput-B1oP-O-k.js";const Y=""+new URL("avatar_placeholder_black-DRyce69K.png",import.meta.url).href,$=""+new URL("avatar_placeholder_white-CbxutB7M.png",import.meta.url).href,y=[{sector:"personal",name:"photoUrl",displayName:"Avatar",editable:!0},{sector:"personal",name:"username",displayName:"Username",editable:!0},{sector:"personal",name:"email",displayName:"Email",editable:!0},{sector:"personal",name:"fullName",displayName:"Full name",editable:!0},{sector:"system",name:"id",displayName:"Inner ID",editable:!1},{sector:"system",name:"tg_id",displayName:"Telegram ID",editable:!1},{sector:"others",name:"languageCode",displayName:"Locale",editable:!1},{sector:"others",name:"role",displayName:"User Role",editable:!1}],q=[{sector:"geolocation",name:"available",displayName:"Geoposition enabled",editable:!1},{sector:"geolocation",name:"latitude",displayName:"Latitude",editable:!1},{sector:"geolocation",name:"longitude",displayName:"Longitude",editable:!1},{sector:"geolocation",name:"formattedAdress",displayName:"FormattedAddress",editable:!1},{sector:"geolocation",name:"country",displayName:"Country name",editable:!1},{sector:"geolocation",name:"city",displayName:"City name",editable:!1},{sector:"geolocation",name:"street",displayName:"Street name",editable:!1},{sector:"geolocation",name:"house",displayName:"House No",editable:!1}],ee=()=>{if(!A())return a.jsx(F,{header:"Oops",description:"Application was launched with missing init data",children:a.jsx("img",{alt:"Telegram sticker",src:"https://xelene.me/telegram.gif",style:{display:"block",width:"144px",height:"144px"}})});const b=O(),S=P(),[d,h]=t.useState(g(C)),[i,u]=t.useState(g(C)),o=g(T),w=JSON.parse(sessionStorage.getItem("saved-user")||"{}"),[s,c]=t.useState(i?w:o),r=g(B),[E,U]=t.useState({available:r.available,...r.latLong,...r.address});t.useEffect(()=>{U({available:r.available,...r.latLong,...r.address})},[r]);const[j,v]=t.useState([]);if(!s)return a.jsx(R,{children:"Something went wrong with user"});t.useEffect(()=>{b(J(i))},[i]),t.useEffect(()=>{JSON.stringify(o)!==JSON.stringify(s)?(sessionStorage.setItem("saved-user",JSON.stringify(s)),v(y.map(e=>s[e.name]!==o[e.name]?e.name:"")),u(!0)):(u(!1),sessionStorage.removeItem("saved-user"),v([]))},[s]),t.useEffect(()=>{i||(console.log("Sync user"),c(o))},[o]);const k=e=>{e.preventDefault(),console.log("Edit mode handler"),h(!0),d&&!i&&h(!1)},I=e=>{e.preventDefault(),console.log("Avatar change");const l=e.currentTarget.files;l&&c({...s,photoUrl:URL.createObjectURL(l[0])})},L=e=>{e.preventDefault(),console.log("Changes saved"),b(G(s)),h(!1),u(!1)},D=e=>{e.preventDefault(),console.log("Changes canceled"),c(o),h(!1),u(!1)},[n,p]=t.useState(!1);return a.jsxs("div",{className:"md:container md:mx-auto pt-2",children:[i&&a.jsx("div",{className:"bg-yellow-400 text-center rounded-lg mb-1",children:"You have uncommited changes!!!"}),a.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[a.jsx(_,{children:"My profile"}),a.jsx(N,{mode:"plain",onClick:k,children:"Edit"})]}),a.jsxs(z,{className:"flex flex-col h-full gap-8",children:[a.jsx(x,{header:"Personal Info",children:y.filter(e=>e.sector==="personal").map(e=>a.jsxs("div",{children:[a.jsx(f,{level:"1",weight:"2",className:"p-6 text-[--tg-theme-hint-color]",children:e.displayName}),e.name==="photoUrl"&&a.jsxs(m,{after:e.editable&&d&&a.jsx(K,{id:"input_file",onChange:I,accept:"image/png, image/jpeg"}),children:[j.includes(e.name)&&a.jsx(M,{type:"number",mode:"critical",large:!0,className:"absolute left-2 top-2 z-10",children:"Edited"}),a.jsx(W,{size:96,src:s.photoUrl?s.photoUrl:S.isDark?$:Y})]}),e.name!=="photoUrl"&&a.jsx(a.Fragment,{children:d&&e.editable?a.jsx(H,{readOnly:!(d&&e.editable),status:j.includes(e.name)?"error":"default",inputMode:"text",placeholder:e.displayName,value:s[e.name],onChange:l=>{switch(e.name){case"username":c({...s,username:l.currentTarget.value});break;case"email":c({...s,email:l.currentTarget.value});break;case"fullName":c({...s,fullName:l.currentTarget.value});break}}}):a.jsx(m,{multiline:n,onClick:()=>p(!n),children:s[e.name]})})]},e.name))}),a.jsx(x,{header:"System Info",children:y.filter(e=>e.sector==="system").map(e=>a.jsxs("div",{children:[a.jsx(f,{level:"1",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:e.displayName}),a.jsx(m,{multiline:n,onClick:()=>p(!n),children:s[e.name]})]},e.name))}),a.jsx(x,{header:"Other Info",children:y.filter(e=>e.sector==="others").map(e=>a.jsxs("div",{children:[a.jsx(f,{level:"1",weight:"2",className:"p-6 text-[--tg-theme-hint-color]",children:e.displayName}),a.jsx(m,{multiline:n,onClick:()=>p(!n),children:s[e.name]})]},e.name))}),a.jsx(x,{header:"Geolocation Info",children:q.map(e=>{var l;return a.jsxs("div",{children:[a.jsx(f,{level:"1",weight:"2",className:"p-6 text-[--tg-theme-hint-color]",children:e.displayName}),a.jsx(m,{multiline:n,onClick:()=>p(!n),children:(l=E[e.name])==null?void 0:l.toString()})]},e.name)})})]}),d&&a.jsx("div",{className:"sticky bottom-1",children:a.jsxs("div",{className:"flex flex-row justify-center items-center",children:[a.jsx(N,{className:"bg-green-400 w-full",onClick:L,children:"Confirm"}),a.jsx(N,{className:"bg-red-400 w-full",onClick:D,children:"Cancel"})]})})]})};export{ee as Profile};
