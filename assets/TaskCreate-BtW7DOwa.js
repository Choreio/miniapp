import{b as Q,e as B,s as V,d as W,r as l,J as _,K as $,j as e,T as ee,C as n,x as se,L as te}from"./index-CuO2ekwN.js";import{F as le,G as ae,M as re}from"./MapContainerYandex-Tgf-YUtT.js";import{I as ne,a as E,L as ce,Z as ie}from"./index-Cvs39o5i.js";import{B as f,L as oe,S as de,b as he,C as R}from"./Section-Btheq3f_.js";import{I as k}from"./Input-C6T9324h.js";import{I as ue,F as me}from"./FileInput-DeN23cCw.js";import"./VisuallyHidden--bsLyBed.js";const be=()=>{var L,D;const w=Q(),g=B(V),j=W(),[o,q]=l.useState(!1),[u,T]=l.useState(""),[c,S]=l.useState(""),[d,I]=l.useState(0),[h,v]=l.useState(),[a,N]=l.useState([]),[i,y]=l.useState({available:!1}),C=l.useMemo(()=>({id:g.id,name:(g.firstName+" "+g.lastName||"").trim()}),[g]),M=()=>{var t,r;const s=JSON.parse(sessionStorage.getItem("saved-task")||"{}");try{T(s.title),S(s.desc),I((t=s==null?void 0:s.reward)==null?void 0:t.cost),v((r=s==null?void 0:s.reward)==null?void 0:r.currency),N(s.attachments||[]),y(s.location)}catch{console.log("Cant parse saved task")}},b=l.useCallback((s,t,r,U,x,K,X)=>({id:Date.now().toString(),title:s,desc:t,reward:{cost:r,currency:U},attachments:x,location:K,customer:X,status:"open"}),[]),[m,p]=l.useState(B(_));l.useEffect(()=>{m&&(console.log("Restore created task"),M())},[m]),l.useEffect(()=>{u.trim()!==""||c.trim()!==""||d!==0||(h||"").trim()!==""||a.length>0||i.available?(console.log("Changes made"),p(!0),sessionStorage.setItem("saved-task",JSON.stringify(b(u,c,d,h||"TON",a,i,C)))):(p(!1),sessionStorage.removeItem("saved-task"))},[u,c,d,h,a,i,C,b]),l.useEffect(()=>{console.log("Update changes store"),j($(m))},[m,j]);const z=s=>{const t=s.currentTarget.files;if(t&&(t==null?void 0:t.length)>0){const r=[];for(let x=0;x<t.length;x++)r.push(URL.createObjectURL(t[x]));N([...a||[],...r])}},A=s=>{const t=[...a];t.splice(s,1),N(t)},G=()=>{const s=document.getElementsByTagName("input");for(let r=0;r<s.length;r++)s[r].blur();if(u.trim().length===0||c.trim().length===0||d===0||(h||"")===""||!i.available)return q(!0);const t=b(u,c,d,h||"TON",a,i,C);j(te(t)),p(!1),sessionStorage.removeItem("created-task"),w("/tasks/task/"+t.id)},J=()=>{p(!1),sessionStorage.removeItem("saved-task"),w("/tasks/list")},[P,F]=l.useState(!1),[H,O]=l.useState(0),Y=s=>{console.log("Open image fullscreen. Index: "+s),F(!0),O(s)},Z=()=>{console.log("Close image fullscreen"),F(!1),O(0)};return e.jsxs("div",{children:[m&&e.jsx("div",{className:"bg-yellow-400 text-center rounded-lg mb-1",children:"You have uncommited changes!!!"}),e.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[e.jsx(ee,{children:"Task creation"}),e.jsx(f,{mode:"plain",onClick:()=>history.back(),children:"Back"})]}),e.jsx(oe,{className:"flex flex-col gap-2 h-full",children:e.jsxs(de,{header:e.jsx(he,{children:"New task"}),children:[e.jsxs("div",{children:[e.jsxs(n,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Title",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(k,{value:u,status:u.length===0&&o?"error":"default",placeholder:"Title...",onChange:s=>{const t=s.currentTarget.value;T(t)}}),e.jsx(n,{className:"pl-8 text-red-400",hidden:!(c.length===0&&o),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(n,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Description",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(k,{placeholder:"Description...",value:c,status:c.length===0&&o?"error":"default",onChange:s=>S(s.currentTarget.value)}),e.jsx(n,{className:"pl-8 text-red-400",hidden:!(c.length===0&&o),children:"This field is required"})]}),e.jsxs("div",{children:[e.jsxs(n,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Reward",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"flex items-center justify-stretch h-fit",children:[e.jsxs("div",{className:"w-2/5 h-full flex flex-col justify-between",children:[e.jsx(k,{placeholder:"Cost...",inputMode:"numeric",type:"number",status:d===0&&o?"error":"default",value:d||"",onChange:s=>{I(Number(s.currentTarget.value))}}),e.jsx(n,{className:"pl-8 text-red-400",hidden:!(d===0&&o),children:"This field is required"})]}),e.jsxs("div",{className:"w-3/5 flex flex-col h-full justify-between",children:[e.jsxs(ne,{className:"h-12 items-center",children:[e.jsx(E,{onClick:()=>v("TON"),mode:h==="TON"?"bezeled":"plain",children:"TON"}),e.jsx(E,{onClick:()=>v("USDT"),mode:h==="USDT"?"bezeled":"plain",children:"USDT"})]}),e.jsx(n,{className:"pl-8 text-red-400",hidden:!((h||"")===""&&o),children:"Please select currency"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"Attachments"}),e.jsx("div",{className:"p-2 grid grid-flow-row grid-cols-4 gap-2",children:a.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx(ue,{size:96,className:"w-full",src:s,onClick:()=>Y(t)}),e.jsx(le,{className:"absolute right-0 -top-2 w-6 h-6 border border-gray-500 rounded-full bg-gray-400 bg-opacity-55",onClick:()=>A(t)})]},t+"/"+s))}),a&&a.length>0&&a.map((s,t)=>e.jsx(R,{className:"pl-6",after:e.jsx(f,{mode:"plain",onClick:()=>A(t),children:"X"}),children:e.jsx(se,{children:s})},t+s)),e.jsx(me,{multiple:!0,label:"Attach a new file",accept:"image/*",onChange:z})]}),e.jsxs("div",{children:[e.jsxs(n,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:["Address",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"overflow-visible",children:[e.jsx(ae,{status:!i.available&&o?"error":"default",geoposition:i||{available:!1},setGeoposition:s=>y(s)}),e.jsx(n,{className:"pl-8 text-red-400",hidden:!(c.length===0&&o),children:"This field is required"})]})]}),e.jsxs("div",{children:[e.jsx(n,{level:"2",weight:"2",className:"pl-6 text-[--tg-theme-hint-color]",children:"On map"}),e.jsx(R,{children:e.jsx(re,{available:i.available,type:"target",center:{latitude:Number(((L=i.latLong)==null?void 0:L.latitude)||52.518073),longitude:Number(((D=i.latLong)==null?void 0:D.longitude)||13.376139)}})})]})]})}),e.jsx("div",{className:"sticky bottom-24",children:e.jsxs("div",{className:"flex flex-row justify-center items-center",children:[e.jsx(f,{className:"bg-green-400 w-full",onClick:G,children:"Create"}),e.jsx(f,{className:"bg-red-400 w-full",onClick:J,children:"Cancel"})]})}),e.jsx(ce,{open:P,close:Z,controller:{closeOnPullDown:!0,closeOnBackdropClick:!0,closeOnPullUp:!0},index:H,plugins:[ie],slides:a==null?void 0:a.map(s=>({src:s}))})]})};export{be as TaskCreate};
