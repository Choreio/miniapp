const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TasksAccordeon-CTUM9txW.js","./index-CDG3nkYV.js","./index-DnftONe8.css","./Input-Crs6bibi.js","./Section-C_ZhClvI.js","./TaskCard-BEa_4eAN.js","./calcDistance-p9X9NEyQ.js","./index-BEA0Odum.js","./MapContainerYandex-CGPmpnnb.js","./FileInput-Bu80b5QI.js","./VisuallyHidden-CjlIbvC_.js","./Avatar-BgnAlz5u.js"])))=>i.map(i=>d[i]);
import{j as a,o as F,p as _,_ as V,v as q,q as O,z as ne,A as Te,r as l,D as Pe,F as Re,G as Ne,x as pe,R as Ae,H as Me,I as ye,b as Le,e as te,s as Xe,J as De,f as ke,T as _e}from"./index-CDG3nkYV.js";import{G as Ye,S as Ie,a as he}from"./GeolocationRequest-GsSbOhUx.js";import{c as k}from"./calcDistance-p9X9NEyQ.js";import{TasksMap as Ve}from"./TasksMap-B3Fl2EIX.js";import{_ as Be,a as Fe,S as He}from"./Section-C_ZhClvI.js";import{F as Ze}from"./Input-Crs6bibi.js";import{V as Oe}from"./VisuallyHidden-CjlIbvC_.js";import{I as me}from"./MapContainerYandex-CGPmpnnb.js";const Y=(e,s,t)=>Math.max(s,Math.min(e,t)),We=e=>{var s=Be({},Fe(e));return a.jsx("svg",F(_({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s),{children:a.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.29289 6.29289c.39053-.39052 1.02369-.39052 1.41422 0L10 11.5858l5.2929-5.29291c.3905-.39052 1.0237-.39052 1.4142 0 .3905.39053.3905 1.02369 0 1.41422l-6 5.99999c-.3905.3905-1.02368.3905-1.41421 0l-6-5.99999c-.39052-.39053-.39052-1.02369 0-1.41422Z",fill:"currentColor"})}))},$e=e=>{var{header:s,before:t,status:n,className:c}=e,u=V(e,["header","before","status","className"]);const d=q(),v=d==="ios"?ne:Te;return a.jsxs(Ze,{header:s,before:t,status:n,className:O("tgui-919c5658483cae11",d==="ios"&&"tgui-5edcb8465ee11055",c),children:[a.jsx(v,_({Component:"select",className:"tgui-a0742fd4c73756f7",multiple:!1},u)),a.jsx(We,{"aria-hidden":!0,className:"tgui-025a45d791e466f6"})]})};function B(e,s,t){const n=l.useRef(s);Pe(()=>{n.current=s},[s]);const c=l.useCallback(h=>n.current&&n.current(h),[]),u=l.useRef(()=>{}),d=l.useCallback(()=>{u.current(),u.current=()=>{}},[]),v=l.useCallback(h=>{if(!Re||(d(),!h))return;const b=_({},t);h.addEventListener(e,c,b),u.current=()=>h.removeEventListener(e,c,b)},[t,c,e,d]);return l.useEffect(()=>d,[d]),l.useMemo(()=>({add:v,remove:d}),[v,d])}const Ge=(e,s)=>({startX:e,startY:s,startT:new Date,duration:0,isPressed:!0,isY:!1,isX:!1,isSlideX:!1,isSlideY:!1,isSlide:!1,clientX:0,clientY:0,shiftX:0,shiftY:0,shiftXAbs:0,shiftYAbs:0}),ve=e=>e.clientX!=null?e.clientX:e.changedTouches&&e.changedTouches[0].clientX,xe=e=>e.clientY!=null?e.clientY:e.changedTouches&&e.changedTouches[0].clientY,ae=()=>Re&&"ontouchstart"in window,ze=()=>ae()?["touchstart","touchmove","touchend","touchcancel"]:["mousedown","mousemove","mouseup","mouseleave"],Ue=e=>{var{Component:s="div",onStart:t,onStartX:n,onStartY:c,onMove:u,onMoveX:d,onMoveY:v,onLeave:h,onEnter:b,onEnd:j,onEndX:R,onEndY:N,onClickCapture:S,usePointerHover:T,slideThreshold:g=5,useCapture:x=!1,noSlideClick:w=!1,stopPropagation:E=!1}=e,M=V(e,["Component","onStart","onStartX","onStartY","onMove","onMoveX","onMoveY","onLeave","onEnter","onEnd","onEndX","onEndY","onClickCapture","usePointerHover","slideThreshold","useCapture","noSlideClick","stopPropagation"]);const i=l.useMemo(ze,[]),f=l.useRef(!1),m=l.useRef(null),I=(r,p)=>{E&&r.stopPropagation(),p.forEach(A=>{var P,L,X;const D=Date.now()-((X=(L=m.current)===null||L===void 0||(P=L.startT)===null||P===void 0?void 0:P.getTime())!==null&&X!==void 0?X:0);A&&A(F(_({},m.current),{duration:D,originalEvent:r}))})},H={capture:x,passive:!1},W=[B(i[1],re,H),B(i[2],o,H),B(i[3],o,H)],J=r=>{r&&W.forEach(p=>p.add(r))},K=()=>{W.forEach(r=>r.remove())},$=B(T?"pointerenter":"mouseenter",b),Z=B(T?"pointerleave":"mouseleave",h),Q=B(i[0],r=>{m.current=Ge(ve(r),xe(r)),I(r,[t,n,c]),J(ae()?r.target:window.document)},{capture:x,passive:!1}),G=l.useRef();Pe(()=>{const r=G.current;r&&($.add(r),Z.add(r),Q.add(r))},[s]);function re(r){var p;const{isPressed:A,isX:P,isY:L,startX:X=0,startY:D=0}=(p=m.current)!==null&&p!==void 0?p:{};if(A){var ee;const oe=ve(r),le=xe(r),ie=oe-X,ce=le-D,z=Math.abs(ie),U=Math.abs(ce);if(r.touches&&r.touches.length>1){o(r);return}if(!P&&!L){const ue=z>=g&&z>U,de=U>=g&&U>z,fe=ue&&(!!d||!!u),ge=de&&(!!v||!!u);m.current&&Object.assign(m.current,{isY:de,isX:ue,isSlideX:fe,isSlideY:ge,isSlide:fe||ge})}!((ee=m.current)===null||ee===void 0)&&ee.isSlide&&(Object.assign(m.current,{clientX:oe,clientY:le,shiftX:ie,shiftY:ce,shiftXAbs:z,shiftYAbs:U}),I(r,[u,m.current.isSlideX&&d,m.current.isSlideY&&v]))}}function o(r){var p;const{isPressed:A,isSlide:P,isSlideX:L,isSlideY:X}=(p=m.current)!==null&&p!==void 0?p:{};A&&I(r,[j,X&&N,L&&R]);const D=ae();D&&P?f.current=!1:f.current=!!P,m.current={},D&&h&&h(r),K()}const C=r=>{const p=r.target;(p.tagName==="A"||p.tagName==="IMG")&&r.preventDefault()},y=r=>{if(!f.current){S&&S(r);return}w?(r.stopPropagation(),r.preventDefault()):S&&S(r),f.current=!1};return a.jsx(s,F(_({},M),{onDragStart:C,onClickCapture:y,ref:G}))},qe=({steps:e})=>{const s=q();return a.jsx(a.Fragment,{children:e.map(({isPassed:t,XCoordinate:n})=>a.jsx("div",{className:O("tgui-b632646f586ff14d",{"tgui-7951a89b824476b3":s==="ios","tgui-2b0a006b5a9ffd68":t}),style:{left:`${n}%`}},n))})},be=l.forwardRef((e,s)=>{var{className:t,inputProps:n,withTooltip:c}=e,u=V(e,["className","inputProps","withTooltip"]);const d=q();return a.jsx("span",F(_({className:O("tgui-83b7253102c6addc",d==="ios"&&"tgui-96f5864d281f94a8",t)},u),{children:a.jsx(Oe,F(_({},n),{Component:"input",type:"range",ref:s,className:O("tgui-abdeb837bfc726cb",t),"aria-orientation":"horizontal"}))}))}),Je=e=>{const{"aria-label":s,"aria-valuetext":t,"aria-labelledby":n}=e,c=V(e,["aria-label","aria-valuetext","aria-labelledby"]);return _({aria:{ariaLabel:s,ariaValueText:t,ariaLabelledBy:n}},c)},Se=e=>e&&["start","end"].includes(e.dataset.type||"")?e.dataset.type:null,Ke=e=>{if(Math.abs(e)<1){const t=e.toExponential().split("e-"),n=t[0].split(".")[1];return(n?n.length:0)+parseInt(t[1],10)}const s=e.toString().split(".")[1];return s?s.length:0},Qe=(e,s,t)=>{const n=Math.round((e-t)/s)*s+t;return Number(n.toFixed(Ke(s)))},et=(e,s,t,n)=>{if(n==null||n<=0)return Y(e,s,t);const c=Qe(e,n,s);return Y(c,s,t)},tt=(e,s,t,n={})=>{const c=(e-s[0])/(s[1]-s[0])*(t[1]-t[0])+t[0];return et(c,t[0],t[1],n.step)},se=(e,s,t)=>(e-s)/(t-s)*100,we=(e,s,t,n,c)=>tt(e,[0,s],[t,n],{step:c}),je=(e,s,t,n,c)=>{const[u,d]=e;if(d===null)return[Y(s,t,n),null];switch(c){case"start":return s>d?[d,d]:[Y(s,t,n),d];case"end":return s<u?[u,u]:[u,Y(s,t,n)];case null:default:return e}},st=(e,s,t)=>{const[n,c]=e;switch(t){case"start":return[s,c];case"end":return[n,s];case null:default:return e}},nt=e=>e[1]!==null,Ee=.1,at=(e,s,t)=>{if(t==="start"||t==="end")return t;const[n,c]=e,u=c!==null?n-Ee:n,d=c!==null?c+Ee:0;return Math.abs(u-s)<=Math.abs(d-s)?"start":"end"},rt=e=>{var{step:s=1,min:t=0,max:n=100,value:c,multiple:u,defaultValue:d=u?[t,n]:t,disabled:v,getAriaLabel:h,getAriaValueText:b,onChange:j}=e,R=V(e,["step","min","max","value","multiple","defaultValue","disabled","getAriaLabel","getAriaValueText","onChange"]);const N=c!==void 0,[S,T]=l.useState(d),g=l.useMemo(()=>{const o=N?c:S;return Array.isArray(o)?[Y(o[0],t,n),Y(o[1],t,n)]:[Y(o,t,n),null]},[N,c,S,t,n]),[x,w]=g,E=u&&w!==null,M=l.useRef({dragging:null,startX:0,containerWidth:0}).current,i=l.useRef(null),f=l.useRef(null),m=l.useRef(null),I=(o,C)=>{v||Ne(o[0],o[1])||(u?nt(o)&&(!N&&T(o),j&&j(o,C)):(!N&&T(o[0]),j&&j(o[0],C)))},H=o=>{if(!i.current)return;const{left:C,width:y}=i.current.getBoundingClientRect();if(!(o.originalEvent.target instanceof HTMLElement))return;const r=Se(o.originalEvent.target),p=o.startX-C,A=we(p,y,t,n,s),P=at(g,A,r);M.dragging=P,M.containerWidth=y,M.startX=p;const L=je(g,A,t,n,P),[X,D]=L;f.current&&(r==="start"||X!==x&&D===w)?(f.current.focus(),o.originalEvent.preventDefault()):m.current&&(r==="end"||D!==w&&X===x)&&(m.current.focus(),o.originalEvent.preventDefault()),I(L,o),o.originalEvent.stopPropagation()},W=o=>{const{startX:C,containerWidth:y,dragging:r}=M,{shiftX:p=0}=o,A=C+p,P=we(A,y,t,n,s);I(je(g,P,t,n,r),o),o.originalEvent.stopPropagation(),o.originalEvent.preventDefault()},J=o=>{M.dragging=null,o.originalEvent.stopPropagation()},K=o=>{I(st(g,Number(o.target.value),Se(o.target)),o)},$=Je(R),{aria:Z}=$,Q=V($,["aria"]),G=o=>{const C=o?1:0;return{"data-type":o?"end":"start",step:s,min:t,value:o&&E?w:x,max:!o&&E?w:n,disabled:v,"aria-label":h?h(C):Z.ariaLabel,"aria-valuetext":b?b(x,C):Z.ariaValueText,"aria-labelledby":Z.ariaLabelledBy,onChange:K}};return{steps:(()=>{if(s===1)return;const o=[],C=Math.floor((n-t)/s);for(let y=0;y<=C;y+=1){const r=t+y*s,p=E?r>=x&&r<=w:r<=x;o.push({isPassed:p,XCoordinate:se(r,t,n)})}return o})(),multiple:E,containerProps:Q,startValueInPercent:se(x,t,n),endReversedValueInPercent:E?se(w,t,n):0,thumbsContainerRef:i,thumbStartInputRef:f,thumbEndInputRef:m,handlePointerStart:H,handlePointerMove:W,handlePointerEnd:J,getInputProps:G}},ot=e=>{var{className:s,disabled:t,before:n,after:c}=e,u=V(e,["className","disabled","before","after"]);const d=q(),{steps:v,multiple:h,containerProps:b,startValueInPercent:j,endReversedValueInPercent:R,thumbsContainerRef:N,thumbStartInputRef:S,thumbEndInputRef:T,handlePointerStart:g,handlePointerMove:x,handlePointerEnd:w,getInputProps:E}=rt(u);return a.jsxs("div",{className:O("tgui-717c3649db8d5af2",d==="ios"&&"tgui-d2e2a2e28ef0f746",t&&"tgui-c591a831de13ba23",s),children:[pe(n)&&a.jsx("div",{className:"tgui-6598607160233201",children:n}),a.jsxs(Ue,F(_({},b),{className:"tgui-35faba867393ce37",onStart:t?void 0:g,onMove:t?void 0:x,onEnd:t?void 0:w,children:[a.jsx("div",{className:"tgui-e11a455378c63b15",children:v!==void 0&&a.jsx(qe,{steps:v})}),a.jsx("div",{className:"tgui-4de4feff2dcc975c",style:h?{left:`${j}%`,right:`${100-R}%`}:{width:`${j}%`}}),a.jsxs("div",{ref:N,className:"tgui-7fe9f0fbc9771947",children:[a.jsx(be,{"data-type":"start",ref:S,style:{left:`${j}%`,zIndex:h&&j>=50?3:void 0},inputProps:E(!1)}),h&&a.jsx(be,{"data-type":"end",ref:T,style:{left:`${R}%`},inputProps:E(!0)})]})]})),pe(c)&&a.jsx("div",{className:"tgui-a56564bcfd4b56e5",children:c})]})};function lt({title:e,titleId:s,...t},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),e?l.createElement("title",{id:s},e):null,l.createElement("path",{fillRule:"evenodd",d:"M2.25 4.5A.75.75 0 0 1 3 3.75h14.25a.75.75 0 0 1 0 1.5H3a.75.75 0 0 1-.75-.75Zm0 4.5A.75.75 0 0 1 3 8.25h9.75a.75.75 0 0 1 0 1.5H3A.75.75 0 0 1 2.25 9Zm15-.75A.75.75 0 0 1 18 9v10.19l2.47-2.47a.75.75 0 1 1 1.06 1.06l-3.75 3.75a.75.75 0 0 1-1.06 0l-3.75-3.75a.75.75 0 1 1 1.06-1.06l2.47 2.47V9a.75.75 0 0 1 .75-.75Zm-15 5.25a.75.75 0 0 1 .75-.75h9.75a.75.75 0 0 1 0 1.5H3a.75.75 0 0 1-.75-.75Z",clipRule:"evenodd"}))}const it=l.forwardRef(lt);function ct({title:e,titleId:s,...t},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),e?l.createElement("title",{id:s},e):null,l.createElement("path",{fillRule:"evenodd",d:"M2.25 4.5A.75.75 0 0 1 3 3.75h14.25a.75.75 0 0 1 0 1.5H3a.75.75 0 0 1-.75-.75Zm14.47 3.97a.75.75 0 0 1 1.06 0l3.75 3.75a.75.75 0 1 1-1.06 1.06L18 10.81V21a.75.75 0 0 1-1.5 0V10.81l-2.47 2.47a.75.75 0 1 1-1.06-1.06l3.75-3.75ZM2.25 9A.75.75 0 0 1 3 8.25h9.75a.75.75 0 0 1 0 1.5H3A.75.75 0 0 1 2.25 9Zm0 4.5a.75.75 0 0 1 .75-.75h5.25a.75.75 0 0 1 0 1.5H3a.75.75 0 0 1-.75-.75Z",clipRule:"evenodd"}))}const ut=l.forwardRef(ct),Ce=Ae.lazy(()=>Me(async()=>{const{TasksAccordeon:e}=await import("./TasksAccordeon-CTUM9txW.js");return{TasksAccordeon:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url).then(({TasksAccordeon:e})=>({default:e}))),bt=()=>{const e=ye(),s=Le(),[t,n]=l.useState(e.mode),c=i=>{console.log("Changing mode"),n(i)};l.useEffect(()=>{["list","map"].includes(e.mode||"")?n(e.mode):n("list")},[e]),l.useEffect(()=>{s("/tasks/all/"+t)},[s,t]);const[u,d]=l.useState(1),[v,h]=l.useState(1e3);l.useEffect(()=>{u<10?h(u*1e3):h(1/0)},[u]);const[b,j]=l.useState("default"),[R,N]=l.useState("desc"),S=te(Xe),T=te(De),g=te(ke),x=l.useMemo(()=>T.filter(i=>{var f,m;return((f=i.acceptedBy)==null?void 0:f.id)!==S.id&&i.status==="open"&&((m=i.customer)==null?void 0:m.id)!==S.id&&k(g.latLong,i.location.latLong)*1e3<=v}).sort((i,f)=>b==="default"?R==="asc"?(console.log("Default sorting ascending"),i.id<f.id?-1:i.id>f.id?1:0):(console.log("Default sorting descending"),i.id<f.id?1:i.id>f.id?-1:0):b==="distance"?R==="asc"?(console.log("Distance sorting ascending"),k(i.location.latLong,g.latLong)<k(f.location.latLong,g.latLong)?-1:k(i.location.latLong,g.latLong)>k(f.location.latLong,g.latLong)?1:0):(console.log("Distance sorting descending"),k(i.location.latLong,g.latLong)<k(f.location.latLong,g.latLong)?1:k(i.location.latLong,g.latLong)>k(f.location.latLong,g.latLong)?-1:0):b==="reward"?R==="asc"?(console.log("Reward sorting ascending"),console.log(i.reward.cost+" < "+f.reward),i.reward.cost<f.reward.cost?-1:i.reward.cost>f.reward.cost?1:0):(console.log("Reward sorting descending"),i.reward.cost<f.reward.cost?1:i.reward.cost>f.reward.cost?-1:0):0),[T,S,g,v,R,b]),w=l.useMemo(()=>T.filter(i=>{var f;return((f=i.acceptedBy)==null?void 0:f.id)===S.id&&i.status==="active"}),[T,S]),[E,M]=l.useState(!1);return l.useEffect(()=>{console.log("Force reopen accordeon"),M(!1),setTimeout(()=>{M(!0)},50)},[x,w]),g.available?a.jsxs("div",{className:"md:container md:mx-auto",children:[a.jsxs("div",{className:"p-2 flex align-middle items-center justify-between w-full",children:[a.jsx(_e,{children:"Tasks around you"}),a.jsxs(Ie,{className:"w-40 h-10 self-end z-[0]",children:[a.jsx(he,{className:"w-4 h-8 align-middle p-1",selected:t==="list",onClick:()=>{c("list")},children:"List"}),a.jsx(he,{selected:t==="map",className:"w-4 h-8 align-middle p-1",onClick:()=>{c("map")},children:"Map"})]})]}),a.jsxs(He,{className:"h-full",children:[t==="list"&&a.jsxs("div",{className:"pl-4 pr-4 flex justify-between items-center w-full",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(ne,{children:"Sort by:"}),a.jsxs($e,{value:b,onChange:i=>{j(i.currentTarget.value)},children:[a.jsx("option",{value:"default",children:"Default"}),a.jsx("option",{value:"distance",children:"Distance"}),a.jsx("option",{value:"reward",children:"Reward"})]})]}),a.jsx("div",{className:"flex items-center gap-4",children:R==="desc"?a.jsx(me,{className:"h-8 w-8",onClick:()=>N("asc"),children:a.jsx(it,{})}):a.jsx(me,{className:"h-8 w-8",onClick:()=>N("desc"),children:a.jsx(ut,{})})})]}),a.jsxs("div",{className:"pl-8 pt-4 pr-8",children:[a.jsxs(ne,{className:"flex",children:["You are looking for tasks in ",v," meters from your current position"]}),a.jsx(ot,{value:u,min:1,max:10,onChange:i=>{console.log("Slider change!"),d(i)}})]}),t==="list"?a.jsxs(a.Fragment,{children:[a.jsx(Ce,{title:"Accepted tasks",tasks:w,mode:"view",open:E}),a.jsx(Ce,{title:"Available tasks",tasks:x,mode:"view",open:E})]}):a.jsx(a.Fragment,{children:a.jsx(Ve,{tasks:[...w,...x],radius:v})})]})]}):a.jsx(Ye,{})};export{bt as AllTasksTab};
